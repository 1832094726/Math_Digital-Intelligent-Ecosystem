# K-12æ•°å­¦æ•™è‚²æ™ºèƒ½æ•°å­—ç”Ÿæ€ç³»ç»Ÿ - æ•°æ®åº“è®¾è®¡è¯´æ˜æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ•°å­¦æ•™è‚²ç”Ÿæ€ç³»ç»Ÿçš„æ•°æ®åº“è®¾è®¡ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ã€å…³ç³»ä¾èµ–ã€æŸ¥è¯¢ç¤ºä¾‹ç­‰ï¼Œä¸ºåç«¯å¼€å‘äººå‘˜æä¾›å®Œæ•´çš„æ•°æ®åº“ä½¿ç”¨æŒ‡å—ã€‚

**ç›¸å…³æ–‡ä»¶**:
- `architect/04_æ•°æ®æ¨¡å‹è®¾è®¡_å®é™…ç‰ˆ.sql` (å½“å‰å®é™…ä½¿ç”¨çš„æ•°æ®åº“ç»“æ„)
- `architect/04_æ•°æ®æ¨¡å‹è®¾è®¡_æ•´åˆç‰ˆ.sql` (ç†æƒ³çš„å®Œæ•´è®¾è®¡ï¼Œæš‚æœªå®æ–½)

**é‡è¦è¯´æ˜**: æœ¬æ–‡æ¡£åŸºäºå½“å‰ç³»ç»Ÿå®é™…è¿è¡Œçš„æ•°æ®åº“ç»“æ„ç¼–å†™ï¼Œç¡®ä¿ä¸ä»£ç å®ç°å®Œå…¨ä¸€è‡´ã€‚

---

## ğŸ—ï¸ æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒæ¨¡å—åˆ’åˆ†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å­¦æ ¡ç»„ç»‡æ¶æ„   â”‚    â”‚   è¯¾ç¨‹æ•™å­¦ä½“ç³»   â”‚    â”‚   ä½œä¸šç®¡ç†ç³»ç»Ÿ   â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ schools      â”‚    â”‚ â€¢ courses      â”‚    â”‚ â€¢ homeworks    â”‚
â”‚ â€¢ grades       â”‚    â”‚ â€¢ subjects     â”‚    â”‚ â€¢ questions    â”‚
â”‚ â€¢ classes      â”‚    â”‚ â€¢ chapters     â”‚    â”‚ â€¢ assignments  â”‚
â”‚ â€¢ class_studentsâ”‚    â”‚ â€¢ lessons      â”‚    â”‚ â€¢ submissions  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·æƒé™ç³»ç»Ÿ   â”‚
                    â”‚                â”‚
                    â”‚ â€¢ users        â”‚
                    â”‚ â€¢ user_sessionsâ”‚
                    â”‚ â€¢ notificationsâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çŸ¥è¯†å›¾è°±ç³»ç»Ÿ   â”‚    â”‚  AIæ™ºèƒ½æ¨èç³»ç»Ÿ  â”‚    â”‚   å­¦ä¹ åˆ†æç³»ç»Ÿ   â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ knowledge_   â”‚    â”‚ â€¢ symbol_      â”‚    â”‚ â€¢ learning_    â”‚
â”‚   points       â”‚    â”‚   recommendationsâ”‚    â”‚   behaviors    â”‚
â”‚ â€¢ knowledge_   â”‚    â”‚ â€¢ problem_     â”‚    â”‚ â€¢ interaction_ â”‚
â”‚   relationshipsâ”‚    â”‚   recommendationsâ”‚    â”‚   logs         â”‚
â”‚ â€¢ concept_maps â”‚    â”‚ â€¢ learning_path_â”‚    â”‚ â€¢ engagement_  â”‚
â”‚               â”‚    â”‚   recommendationsâ”‚    â”‚   metrics      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é”™è¯¯åˆ†æç³»ç»Ÿ   â”‚    â”‚  è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿ  â”‚
â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ error_       â”‚    â”‚ â€¢ adaptive_    â”‚
â”‚   patterns     â”‚    â”‚   paths        â”‚
â”‚ â€¢ misconception_â”‚    â”‚ â€¢ mastery_     â”‚
â”‚   analysis     â”‚    â”‚   tracking     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“è§„æ¨¡ç»Ÿè®¡
- **æ€»è¡¨æ•°**: 38ä¸ªè¡¨ (ä»22ä¸ªåŸºç¡€è¡¨æ‰©å±•åˆ°38ä¸ªæ™ºèƒ½åŒ–è¡¨)
- **åŸºç¡€ç³»ç»Ÿ**: 22ä¸ªè¡¨ (ç”¨æˆ·æƒé™ã€å­¦æ ¡æ¶æ„ã€è¯¾ç¨‹ä½“ç³»ã€ä½œä¸šç®¡ç†)
- **æ™ºèƒ½åŒ–ç³»ç»Ÿ**: 16ä¸ªæ–°å¢è¡¨ (çŸ¥è¯†å›¾è°±ã€AIæ¨èã€å­¦ä¹ åˆ†æã€é”™è¯¯åˆ†æã€è‡ªé€‚åº”å­¦ä¹ )
- **å…³ç³»æ•°é‡**: 50+ä¸ªè¡¨å…³ç³»
- **æ¨¡å—æ•°é‡**: 11ä¸ªåŠŸèƒ½æ¨¡å—

---

## ğŸ“š æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. å­¦æ ¡ç»„ç»‡æ¶æ„æ¨¡å—

#### ğŸ« å­¦æ ¡å±‚çº§å…³ç³»
```
schools (å­¦æ ¡) 
    â†“ 1:N
grades (å¹´çº§)
    â†“ 1:N  
classes (ç­çº§)
    â†“ N:N
class_students (ç­çº§å­¦ç”Ÿå…³è”)
    â†“ N:1
users (å­¦ç”Ÿç”¨æˆ·)
```

#### å…³é”®æŸ¥è¯¢ç¤ºä¾‹
```sql
-- è·å–æŸä¸ªå­¦æ ¡çš„æ‰€æœ‰ç­çº§ä¿¡æ¯
SELECT s.school_name, g.grade_name, c.class_name, c.class_code
FROM schools s
JOIN grades g ON s.id = g.school_id
JOIN classes c ON g.id = c.grade_id
WHERE s.id = ?;

-- è·å–ç­çº§çš„æ‰€æœ‰å­¦ç”Ÿ
SELECT u.real_name, u.student_id, cs.student_number
FROM classes c
JOIN class_students cs ON c.id = cs.class_id
JOIN users u ON cs.student_id = u.id
WHERE c.id = ? AND cs.is_active = 1;
```

### 2. ä½œä¸šç®¡ç†ç³»ç»Ÿæ¨¡å—

#### ğŸ“ ä½œä¸šæµç¨‹å…³ç³»
```
homeworks (ä½œä¸šæ¨¡æ¿)
    â†“ 1:N
homework_assignments (ä½œä¸šåˆ†é…)
    â†“ 1:N
homework_submissions (å­¦ç”Ÿæäº¤)
    â†“ 1:1
homework_progress (ç­”é¢˜è¿›åº¦)
```

#### å…³é”®æŸ¥è¯¢ç¤ºä¾‹
```sql
-- è·å–ä½œä¸šçš„æ‰€æœ‰é¢˜ç›®
SELECT q.id, q.title, q.content, q.question_type, q.score
FROM homeworks h
JOIN questions q ON h.id = q.homework_id
WHERE h.id = ?
ORDER BY q.question_order;

-- è·å–å­¦ç”Ÿçš„ä½œä¸šåˆ—è¡¨
SELECT h.title, h.subject, ha.due_date_override, hs.status
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = ?
WHERE ha.assigned_to_type = 'student' AND ha.assigned_to_id = ?
   OR ha.assigned_to_type = 'class' AND ha.assigned_to_id IN (
       SELECT class_id FROM class_students WHERE student_id = ?
   );
```

### 3. ç”¨æˆ·æƒé™ç³»ç»Ÿæ¨¡å—

#### ğŸ‘¥ ç”¨æˆ·è§’è‰²å…³ç³»
```
users (ç”¨æˆ·åŸºç¡€ä¿¡æ¯)
    â†“ 1:N
user_sessions (ç”¨æˆ·ä¼šè¯)

users (ç”¨æˆ·)
    â†“ 1:N  
notifications (é€šçŸ¥æ¶ˆæ¯)
```

---

## ğŸ”— è¡¨å…³ç³»è¯¦è§£

### ä¸€å¯¹å¤šå…³ç³» (1:N)

| ä¸»è¡¨ | ä»è¡¨ | å¤–é”®å­—æ®µ | è¯´æ˜ |
|------|------|----------|------|
| schools | grades | school_id | ä¸€ä¸ªå­¦æ ¡æœ‰å¤šä¸ªå¹´çº§ |
| grades | classes | grade_id | ä¸€ä¸ªå¹´çº§æœ‰å¤šä¸ªç­çº§ |
| homeworks | questions | homework_id | ä¸€ä¸ªä½œä¸šæœ‰å¤šä¸ªé¢˜ç›® |
| homeworks | homework_assignments | homework_id | ä¸€ä¸ªä½œä¸šå¯ä»¥åˆ†é…ç»™å¤šä¸ªå¯¹è±¡ |
| users | homework_submissions | student_id | ä¸€ä¸ªå­¦ç”Ÿæœ‰å¤šä¸ªä½œä¸šæäº¤ |
| users | notifications | user_id | ä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªé€šçŸ¥ |

### å¤šå¯¹å¤šå…³ç³» (N:N)

| å…³è”è¡¨ | ä¸»è¡¨1 | ä¸»è¡¨2 | è¯´æ˜ |
|--------|-------|-------|------|
| class_students | classes | users | ç­çº§å’Œå­¦ç”Ÿçš„å¤šå¯¹å¤šå…³ç³» |
| homework_favorites | users | homework_assignments | å­¦ç”Ÿå’Œä½œä¸šæ”¶è—çš„å¤šå¯¹å¤šå…³ç³» |

### ä¸€å¯¹ä¸€å…³ç³» (1:1)

| è¡¨1 | è¡¨2 | å…³è”å­—æ®µ | è¯´æ˜ |
|-----|-----|----------|------|
| homework_assignments | homework_submissions | assignment_id | æ¯ä¸ªä½œä¸šåˆ†é…å¯¹åº”ä¸€ä¸ªå­¦ç”Ÿæäº¤ |
| homework_submissions | homework_progress | student_id + homework_id | æ¯ä¸ªæäº¤å¯¹åº”ä¸€ä¸ªè¿›åº¦è®°å½• |

---

## ğŸ“Š å¸¸ç”¨æŸ¥è¯¢åœºæ™¯

### ğŸ¯ æ ¸å¿ƒä¸šåŠ¡é—®é¢˜è§£ç­”

#### Q1: ä½œä¸šæ˜¯ä¸æ˜¯æŒ‰ç­çº§å‡ºçš„ï¼Ÿ
**ç­”æ¡ˆ**: ä½œä¸šåˆ†é…æ”¯æŒå¤šç§æ–¹å¼ï¼Œä¸ä»…é™äºç­çº§ï¼š

```sql
-- æŸ¥çœ‹ä½œä¸šåˆ†é…çš„æ‰€æœ‰æ–¹å¼
SELECT
    assigned_to_type,
    COUNT(*) as assignment_count,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM homework_assignments) as percentage
FROM homework_assignments
GROUP BY assigned_to_type;

-- ç»“æœç¤ºä¾‹ï¼š
-- assigned_to_type | assignment_count | percentage
-- 'class'          | 150             | 75.0%      (æŒ‰ç­çº§åˆ†é…)
-- 'student'        | 30              | 15.0%      (æŒ‰ä¸ªäººåˆ†é…)
-- 'grade'          | 20              | 10.0%      (æŒ‰å¹´çº§åˆ†é…)
-- 'all'            | 0               | 0.0%       (å…¨æ ¡åˆ†é…)
```

**åˆ†é…ç±»å‹è¯´æ˜**:
- `class`: æŒ‰ç­çº§åˆ†é… (æœ€å¸¸ç”¨ï¼Œçº¦75%)
- `student`: æŒ‰ä¸ªäººåˆ†é… (ä¸ªæ€§åŒ–ä½œä¸š)
- `grade`: æŒ‰å¹´çº§åˆ†é… (ç»Ÿä¸€è€ƒè¯•)
- `all`: å…¨æ ¡åˆ†é… (é‡è¦é€šçŸ¥ä½œä¸š)

#### Q2: å¦‚ä½•è·å–æŸä¸ªè€å¸ˆåœ¨æŸä¸ªç­çº§çš„ä½œä¸šè®°å½•ï¼Ÿ

```sql
-- æ–¹æ¡ˆ1: è·å–è€å¸ˆåœ¨æŒ‡å®šç­çº§å¸ƒç½®çš„æ‰€æœ‰ä½œä¸š
SELECT
    h.id as homework_id,
    h.title as homework_title,
    h.subject,
    h.created_at as created_time,
    ha.assigned_at,
    ha.due_date_override as due_date,
    c.class_name,
    COUNT(cs.student_id) as total_students,
    COUNT(hs.id) as submitted_count,
    ROUND(COUNT(hs.id) * 100.0 / COUNT(cs.student_id), 2) as completion_rate
FROM homeworks h
JOIN homework_assignments ha ON h.id = ha.homework_id
JOIN classes c ON ha.assigned_to_id = c.id
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE h.created_by = ? -- è€å¸ˆID
  AND ha.assigned_to_type = 'class'
  AND ha.assigned_to_id = ? -- ç­çº§ID
  AND ha.is_active = 1
GROUP BY h.id, h.title, h.subject, h.created_at, ha.assigned_at, ha.due_date_override, c.class_name
ORDER BY ha.assigned_at DESC;
```

#### Q3: å¦‚ä½•è·å–è€å¸ˆç®¡ç†çš„æ‰€æœ‰ç­çº§çš„ä½œä¸šæƒ…å†µï¼Ÿ

```sql
-- æ–¹æ¡ˆ2: è·å–è€å¸ˆä½œä¸ºç­ä¸»ä»»çš„æ‰€æœ‰ç­çº§ä½œä¸šæƒ…å†µ
SELECT
    c.class_name,
    c.class_code,
    h.title as homework_title,
    h.subject,
    ha.assigned_at,
    COUNT(cs.student_id) as class_size,
    COUNT(hs.id) as submitted_count,
    AVG(hs.score) as average_score,
    CASE
        WHEN ha.due_date_override < NOW() AND COUNT(hs.id) < COUNT(cs.student_id)
        THEN 'overdue'
        ELSE 'normal'
    END as status
FROM classes c
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
JOIN homework_assignments ha ON c.id = ha.assigned_to_id AND ha.assigned_to_type = 'class'
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE c.head_teacher_id = ? -- è€å¸ˆID (ç­ä¸»ä»»)
GROUP BY c.id, c.class_name, c.class_code, h.id, h.title, h.subject, ha.assigned_at, ha.due_date_override
ORDER BY c.class_name, ha.assigned_at DESC;
```

### åœºæ™¯1: è·å–ç­çº§çš„ä½œä¸šå®Œæˆæƒ…å†µ
```sql
SELECT
    u.real_name AS student_name,
    h.title AS homework_title,
    COALESCE(hs.status, 'not_started') AS status,
    hs.score,
    hs.submitted_at
FROM class_students cs
JOIN users u ON cs.student_id = u.id
CROSS JOIN homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = u.id
WHERE cs.class_id = ? AND ha.assigned_to_type = 'class' AND ha.assigned_to_id = ?
ORDER BY u.real_name, h.title;
```

#### Q4: å¦‚ä½•åŒºåˆ†è€å¸ˆå¸ƒç½®çš„ä½œä¸šå’Œå…¶ä»–è€å¸ˆçš„ä½œä¸šï¼Ÿ

```sql
-- æ–¹æ¡ˆ3: åŒºåˆ†ä½œä¸šæ¥æº - æˆ‘å¸ƒç½®çš„ vs å…¶ä»–è€å¸ˆå¸ƒç½®çš„
SELECT
    h.title,
    h.subject,
    creator.real_name as created_by_teacher,
    CASE
        WHEN h.created_by = ? THEN 'æˆ‘å¸ƒç½®çš„'
        ELSE 'å…¶ä»–è€å¸ˆå¸ƒç½®çš„'
    END as assignment_source,
    ha.assigned_at,
    c.class_name
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
JOIN users creator ON h.created_by = creator.id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE ha.assigned_to_type = 'class'
  AND ha.assigned_to_id = ? -- ç­çº§ID
  AND ha.is_active = 1
ORDER BY assignment_source, ha.assigned_at DESC;
```

#### Q5: å¦‚ä½•è·å–è€å¸ˆè·¨ç­çº§çš„ä½œä¸šåˆ†é…æƒ…å†µï¼Ÿ

```sql
-- æ–¹æ¡ˆ4: è€å¸ˆçš„è·¨ç­çº§ä½œä¸šåˆ†é…ç»Ÿè®¡
SELECT
    h.title as homework_title,
    h.subject,
    h.created_at,
    GROUP_CONCAT(c.class_name ORDER BY c.class_name) as assigned_classes,
    COUNT(DISTINCT ha.assigned_to_id) as class_count,
    SUM(
        SELECT COUNT(*)
        FROM class_students cs
        WHERE cs.class_id = ha.assigned_to_id AND cs.is_active = 1
    ) as total_students
FROM homeworks h
JOIN homework_assignments ha ON h.id = ha.homework_id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE h.created_by = ? -- è€å¸ˆID
  AND ha.assigned_to_type = 'class'
  AND ha.is_active = 1
GROUP BY h.id, h.title, h.subject, h.created_at
ORDER BY h.created_at DESC;
```

### åœºæ™¯2: è·å–å­¦ç”Ÿçš„å­¦ä¹ è¿›åº¦ç»Ÿè®¡
```sql
SELECT
    COUNT(*) AS total_assignments,
    SUM(CASE WHEN hs.status = 'submitted' THEN 1 ELSE 0 END) AS completed_count,
    AVG(hs.score) AS average_score,
    SUM(hs.time_spent) AS total_time_spent
FROM homework_assignments ha
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = ?
WHERE (ha.assigned_to_type = 'student' AND ha.assigned_to_id = ?)
   OR (ha.assigned_to_type = 'class' AND ha.assigned_to_id IN (
       SELECT class_id FROM class_students WHERE student_id = ?
   ));
```

### åœºæ™¯3: æ•™å¸ˆä½œä¸šç®¡ç†å®Œæ•´åœºæ™¯

#### 3.1 è·å–æ•™å¸ˆçš„ç­çº§ç®¡ç†ä¿¡æ¯
```sql
SELECT
    c.class_name,
    c.class_code,
    COUNT(cs.student_id) AS student_count,
    COUNT(DISTINCT ha.id) AS assignment_count,
    AVG(hs.score) AS class_average_score
FROM classes c
LEFT JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_assignments ha ON c.id = ha.assigned_to_id AND ha.assigned_to_type = 'class'
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id
WHERE c.head_teacher_id = ?
GROUP BY c.id, c.class_name, c.class_code;
```

#### 3.2 æ•™å¸ˆä½œä¸šç®¡ç†ä»ªè¡¨æ¿æ•°æ®
```sql
-- è·å–æ•™å¸ˆçš„ä½œä¸šç®¡ç†æ¦‚è§ˆæ•°æ®
SELECT
    -- åŸºç¡€ç»Ÿè®¡
    COUNT(DISTINCT h.id) as total_homeworks_created,
    COUNT(DISTINCT ha.id) as total_assignments,
    COUNT(DISTINCT ha.assigned_to_id) as classes_assigned_to,

    -- å®Œæˆæƒ…å†µç»Ÿè®¡
    COUNT(DISTINCT hs.id) as total_submissions,
    COUNT(DISTINCT CASE WHEN hs.status = 'submitted' THEN hs.id END) as completed_submissions,
    COUNT(DISTINCT CASE WHEN hs.status = 'graded' THEN hs.id END) as graded_submissions,

    -- å¹³å‡åˆ†ç»Ÿè®¡
    AVG(hs.score) as overall_average_score,

    -- æ—¶é—´ç»Ÿè®¡
    AVG(hs.time_spent) as average_time_spent,

    -- æœ€è¿‘æ´»åŠ¨
    MAX(ha.assigned_at) as last_assignment_date,
    MAX(hs.submitted_at) as last_submission_date

FROM homeworks h
LEFT JOIN homework_assignments ha ON h.id = ha.homework_id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id
WHERE h.created_by = ? -- æ•™å¸ˆID
  AND ha.is_active = 1;
```

#### 3.3 æ•™å¸ˆçš„å¾…å¤„ç†ä»»åŠ¡åˆ—è¡¨
```sql
-- è·å–éœ€è¦æ•™å¸ˆå¤„ç†çš„ä»»åŠ¡
SELECT
    'grading' as task_type,
    h.title as homework_title,
    c.class_name,
    COUNT(*) as pending_count,
    MIN(hs.submitted_at) as earliest_submission
FROM homework_submissions hs
JOIN homework_assignments ha ON hs.assignment_id = ha.id
JOIN homeworks h ON ha.homework_id = h.id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE h.created_by = ? -- æ•™å¸ˆID
  AND hs.status = 'submitted' -- å·²æäº¤ä½†æœªè¯„åˆ†
  AND ha.assigned_to_type = 'class'
GROUP BY h.id, h.title, c.class_name

UNION ALL

SELECT
    'overdue_reminder' as task_type,
    h.title as homework_title,
    c.class_name,
    COUNT(cs.student_id) - COUNT(hs.id) as not_submitted_count,
    ha.due_date_override as due_date
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
JOIN classes c ON ha.assigned_to_id = c.id
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE h.created_by = ? -- æ•™å¸ˆID
  AND ha.assigned_to_type = 'class'
  AND ha.due_date_override < NOW() -- å·²è¿‡æœŸ
  AND ha.is_active = 1
GROUP BY h.id, h.title, c.class_name, ha.due_date_override
HAVING not_submitted_count > 0

ORDER BY task_type, earliest_submission DESC;
```

---

## ğŸ” ç´¢å¼•ä¼˜åŒ–å»ºè®®

### é«˜é¢‘æŸ¥è¯¢ç´¢å¼•
```sql
-- ä½œä¸šæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_homework_assignments_student ON homework_assignments(assigned_to_type, assigned_to_id);
CREATE INDEX idx_homework_submissions_student_status ON homework_submissions(student_id, status);
CREATE INDEX idx_questions_homework_order ON questions(homework_id, question_order);

-- ç­çº§ç®¡ç†ä¼˜åŒ–  
CREATE INDEX idx_class_students_active ON class_students(class_id, is_active);
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read, created_at);

-- æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_homework_assignments_due_date ON homework_assignments(due_date_override);
CREATE INDEX idx_homework_submissions_submitted_at ON homework_submissions(submitted_at);
```

---

## âš ï¸ æ•°æ®å®Œæ•´æ€§çº¦æŸ

### å¤–é”®çº¦æŸ
- æ‰€æœ‰å…³è”è¡¨éƒ½è®¾ç½®äº†å¤–é”®çº¦æŸï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- åˆ é™¤æ“ä½œéœ€è¦è€ƒè™‘çº§è”å½±å“

### ä¸šåŠ¡è§„åˆ™çº¦æŸ
- å­¦ç”Ÿåªèƒ½å±äºåŒä¸€å­¦æ ¡çš„ç­çº§
- ä½œä¸šåˆ†é…çš„ç›®æ ‡å¿…é¡»å­˜åœ¨ï¼ˆå­¦ç”Ÿ/ç­çº§/å¹´çº§ï¼‰
- ä½œä¸šæäº¤å¿…é¡»åœ¨æˆªæ­¢æ—¶é—´å‰ï¼ˆä¸šåŠ¡å±‚æ§åˆ¶ï¼‰

### æ•°æ®éªŒè¯è§„åˆ™
- ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§
- å¯†ç å“ˆå¸Œå­˜å‚¨
- æ—¶é—´å­—æ®µçš„åˆç†æ€§æ£€æŸ¥

---

## ğŸš€ å¼€å‘ä½¿ç”¨æŒ‡å—

### 1. æ–°å¢ä½œä¸šæµç¨‹
1. åœ¨ `homeworks` è¡¨åˆ›å»ºä½œä¸šæ¨¡æ¿
2. åœ¨ `questions` è¡¨æ·»åŠ é¢˜ç›®
3. åœ¨ `homework_assignments` è¡¨åˆ›å»ºåˆ†é…è®°å½•
4. ç³»ç»Ÿè‡ªåŠ¨åœ¨ `notifications` è¡¨åˆ›å»ºé€šçŸ¥

### 2. å­¦ç”Ÿç­”é¢˜æµç¨‹
1. æŸ¥è¯¢ `homework_assignments` è·å–åˆ†é…çš„ä½œä¸š
2. åœ¨ `homework_progress` è¡¨ä¿å­˜ç­”é¢˜è¿›åº¦
3. åœ¨ `homework_submissions` è¡¨æäº¤æœ€ç»ˆç­”æ¡ˆ

### 3. ç­çº§ç®¡ç†æµç¨‹
1. é€šè¿‡ `class_students` è¡¨ç®¡ç†ç­çº§æˆå‘˜
2. ä½¿ç”¨ `homework_assignments` è¿›è¡Œæ‰¹é‡ä½œä¸šåˆ†é…
3. é€šè¿‡ç»Ÿè®¡æŸ¥è¯¢è·å–ç­çº§æ•´ä½“æƒ…å†µ

---

---

## ğŸ“‹ å®Œæ•´è¡¨ç»“æ„æ¸…å•

### å­¦æ ¡ç»„ç»‡æ¶æ„ (6å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| schools | å­¦æ ¡åŸºç¡€ä¿¡æ¯ | school_name, school_code, school_type | 1:N â†’ grades |
| grades | å¹´çº§ä¿¡æ¯ | grade_name, grade_level, academic_year | N:1 â† schools, 1:N â†’ classes |
| classes | ç­çº§ä¿¡æ¯ | class_name, class_code, head_teacher_id | N:1 â† grades, 1:N â†’ class_students |
| class_students | ç­çº§å­¦ç”Ÿå…³è” | class_id, student_id, student_number | N:1 â† classes, N:1 â† users |
| curriculum_standards | è¯¾ç¨‹æ ‡å‡† | standard_name, grade_range | N:1 â† schools |
| subjects | å­¦ç§‘ä¿¡æ¯ | subject_name, subject_code | N:1 â† curriculum_standards |

### è¯¾ç¨‹æ•™å­¦ä½“ç³» (4å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| courses | è¯¾ç¨‹ä¿¡æ¯ | course_name, grade_level, semester | N:1 â† subjects |
| course_modules | è¯¾ç¨‹æ¨¡å— | module_name, module_order, learning_goals | N:1 â† courses |
| chapters | ç« èŠ‚ä¿¡æ¯ | chapter_name, chapter_order, difficulty_level | N:1 â† course_modules |
| lessons | è¯¾æ—¶ä¿¡æ¯ | lesson_title, duration_minutes, lesson_type | N:1 â† chapters |

### ä½œä¸šç®¡ç†ç³»ç»Ÿ (8å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| homeworks | ä½œä¸šæ¨¡æ¿ | title, subject, grade, difficulty_level | 1:N â†’ questions |
| questions | é¢˜ç›®ä¿¡æ¯ | title, content, question_type, score | N:1 â† homeworks |
| homework_assignments | ä½œä¸šåˆ†é… | homework_id, assigned_to_type, assigned_to_id | N:1 â† homeworks |
| homework_submissions | ä½œä¸šæäº¤ | assignment_id, student_id, answers, score | N:1 â† homework_assignments |
| homework_progress | ç­”é¢˜è¿›åº¦ | student_id, homework_id, progress_data | N:1 â† users, N:1 â† homeworks |
| homework_favorites | ä½œä¸šæ”¶è— | student_id, assignment_id | N:1 â† users, N:1 â† homework_assignments |
| homework_reminders | ä½œä¸šæé†’ | student_id, assignment_id, reminder_time | N:1 â† users, N:1 â† homework_assignments |
| simple_questions | ç®€å•é¢˜ç›®(æµ‹è¯•) | homework_id, title, content, answer | N:1 â† homeworks |

### ç”¨æˆ·æƒé™ç³»ç»Ÿ (3å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| users | ç”¨æˆ·åŸºç¡€ä¿¡æ¯ | username, email, role, real_name | 1:N â†’ user_sessions |
| user_sessions | ç”¨æˆ·ä¼šè¯ | user_id, session_token, expires_at | N:1 â† users |
| notifications | é€šçŸ¥æ¶ˆæ¯ | user_id, title, content, is_read | N:1 â† users |

### æ•™å­¦ç®¡ç†ç³»ç»Ÿ (2å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| class_schedules | è¯¾ç¨‹å®‰æ’ | course_id, class_id, teacher_id, time_slot | N:1 â† courses, N:1 â† classes |
| learning_paths | å­¦ä¹ è·¯å¾„ | student_id, path_structure, completion_rate | N:1 â† users |

### çŸ¥è¯†å›¾è°±ç³»ç»Ÿ (4å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| knowledge_points | çŸ¥è¯†ç‚¹å®šä¹‰ | name, description, grade_level, difficulty_level, cognitive_type | N:1 â† subjects |
| knowledge_relationships | çŸ¥è¯†ç‚¹å…³ç³» | source_point_id, target_point_id, relationship_type, strength | N:1 â† knowledge_points |
| concept_maps | æ¦‚å¿µå›¾ | title, map_data, layout_config, created_by | N:1 â† subjects, N:1 â† users |
| question_knowledge_points | é¢˜ç›®çŸ¥è¯†ç‚¹å…³è” | question_id, knowledge_point_id, relevance_score | N:1 â† questions, N:1 â† knowledge_points |

### AIæ™ºèƒ½æ¨èç³»ç»Ÿ (3å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| symbol_recommendations | ç¬¦å·æ¨è | user_id, context, recommended_symbols, success_rate | N:1 â† users |
| problem_recommendations | é¢˜ç›®æ¨è | user_id, question_id, difficulty_match, predicted_success_rate | N:1 â† users, N:1 â† questions |
| learning_path_recommendations | å­¦ä¹ è·¯å¾„æ¨è | user_id, recommended_path, path_type, success_prediction | N:1 â† users |

### å­¦ä¹ åˆ†æç³»ç»Ÿ (3å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| learning_behaviors | å­¦ä¹ è¡Œä¸º | user_id, behavior_type, behavior_data, timestamp | N:1 â† users |
| interaction_logs | äº¤äº’æ—¥å¿— | user_id, homework_id, question_id, interaction_type, response_time | N:1 â† users, N:1 â† homeworks, N:1 â† questions |
| engagement_metrics | å‚ä¸åº¦æŒ‡æ ‡ | user_id, date, session_duration, focus_score, persistence_score | N:1 â† users |

### é”™è¯¯åˆ†æç³»ç»Ÿ (2å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| error_patterns | é”™è¯¯æ¨¡å¼ | question_id, error_type, error_description, frequency | N:1 â† questions |
| misconception_analysis | è¯¯è§£åˆ†æ | user_id, knowledge_point_id, misconception_type, confidence_level | N:1 â† users, N:1 â† knowledge_points |

### è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿ (2å¼ è¡¨)
| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ | å…³è”å…³ç³» |
|------|------|----------|----------|
| adaptive_paths | è‡ªé€‚åº”è·¯å¾„ | user_id, current_state, target_state, difficulty_adjustment | N:1 â† users |
| mastery_tracking | æŒæ¡åº¦è·Ÿè¸ª | user_id, knowledge_point_id, mastery_level, decay_rate | N:1 â† users, N:1 â† knowledge_points |

---

## ğŸ”§ å¼€å‘æœ€ä½³å®è·µ

### 1. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
```sql
-- âœ… æ¨èï¼šä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡ŒæŸ¥è¯¢
SELECT * FROM homework_assignments
WHERE assigned_to_type = 'class' AND assigned_to_id = ?;

-- âŒ é¿å…ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM homework_assignments
WHERE JSON_EXTRACT(notes, '$.priority') = 'high';
```

### 2. äº‹åŠ¡å¤„ç†ç¤ºä¾‹
```sql
-- åˆ›å»ºä½œä¸šå¹¶åˆ†é…çš„äº‹åŠ¡
START TRANSACTION;

INSERT INTO homeworks (title, subject, grade, created_by)
VALUES (?, ?, ?, ?);
SET @homework_id = LAST_INSERT_ID();

INSERT INTO questions (homework_id, title, content, score)
VALUES (@homework_id, ?, ?, ?);

INSERT INTO homework_assignments (homework_id, assigned_to_type, assigned_to_id, assigned_by)
VALUES (@homework_id, 'class', ?, ?);

COMMIT;
```

### 3. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
```sql
-- æ£€æŸ¥å­¤ç«‹çš„ä½œä¸šæäº¤è®°å½•
SELECT hs.id, hs.assignment_id
FROM homework_submissions hs
LEFT JOIN homework_assignments ha ON hs.assignment_id = ha.id
WHERE ha.id IS NULL;

-- æ£€æŸ¥æ— æ•ˆçš„ç­çº§å­¦ç”Ÿå…³è”
SELECT cs.id, cs.class_id, cs.student_id
FROM class_students cs
LEFT JOIN classes c ON cs.class_id = c.id
LEFT JOIN users u ON cs.student_id = u.id
WHERE c.id IS NULL OR u.id IS NULL;
```

---

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### é‡è¦æŒ‡æ ‡ç›‘æ§
- ä½œä¸šæäº¤ç‡ï¼š`homework_submissions.status = 'submitted'` çš„æ¯”ä¾‹
- ç³»ç»Ÿæ´»è·ƒåº¦ï¼š`user_sessions.is_active = 1` çš„æ•°é‡
- æ•°æ®å¢é•¿ï¼šå„ä¸»è¦è¡¨çš„è®°å½•æ•°å¢é•¿è¶‹åŠ¿

### å®šæœŸç»´æŠ¤ä»»åŠ¡
- æ¸…ç†è¿‡æœŸçš„ç”¨æˆ·ä¼šè¯ï¼š`user_sessions.expires_at < NOW()`
- å½’æ¡£å†å²ä½œä¸šæ•°æ®ï¼šè¶…è¿‡å­¦å¹´çš„ä½œä¸šè®°å½•
- ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼šåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

---

**ğŸ“ æ³¨æ„**: æœ¬æ–‡æ¡£åŸºäº `architect/04_æ•°æ®æ¨¡å‹è®¾è®¡_æ•´åˆç‰ˆ.sql` çš„è¡¨ç»“æ„è®¾è®¡ï¼Œå¼€å‘æ—¶è¯·å‚è€ƒæœ€æ–°çš„SQLæ–‡ä»¶è·å–å‡†ç¡®çš„å­—æ®µå®šä¹‰ã€‚
