# K-12数学教育智能数字生态系统 - 数据库设计说明文档

## 📋 文档概述

本文档详细说明了数学教育生态系统的数据库设计，包括表结构、关系依赖、查询示例等，为后端开发人员提供完整的数据库使用指南。

**相关文件**:
- `architect/04_数据模型设计_实际版.sql` (当前实际使用的数据库结构)
- `architect/04_数据模型设计_整合版.sql` (理想的完整设计，暂未实施)

**重要说明**: 本文档基于当前系统实际运行的数据库结构编写，确保与代码实现完全一致。

---

## 🏗️ 数据库架构概览

### 核心模块划分
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   学校组织架构   │    │   课程教学体系   │    │   作业管理系统   │
│                │    │                │    │                │
│ • schools      │    │ • courses      │    │ • homeworks    │
│ • grades       │    │ • subjects     │    │ • questions    │
│ • classes      │    │ • chapters     │    │ • assignments  │
│ • class_students│    │ • lessons      │    │ • submissions  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   用户权限系统   │
                    │                │
                    │ • users        │
                    │ • user_sessions│
                    │ • notifications│
                    └─────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   知识图谱系统   │    │  AI智能推荐系统  │    │   学习分析系统   │
│                │    │                │    │                │
│ • knowledge_   │    │ • symbol_      │    │ • learning_    │
│   points       │    │   recommendations│    │   behaviors    │
│ • knowledge_   │    │ • problem_     │    │ • interaction_ │
│   relationships│    │   recommendations│    │   logs         │
│ • concept_maps │    │ • learning_path_│    │ • engagement_  │
│               │    │   recommendations│    │   metrics      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐
│   错误分析系统   │    │  自适应学习系统  │
│                │    │                │
│ • error_       │    │ • adaptive_    │
│   patterns     │    │   paths        │
│ • misconception_│    │ • mastery_     │
│   analysis     │    │   tracking     │
└─────────────────┘    └─────────────────┘
```

### 数据库规模统计
- **总表数**: 38个表 (从22个基础表扩展到38个智能化表)
- **基础系统**: 22个表 (用户权限、学校架构、课程体系、作业管理)
- **智能化系统**: 16个新增表 (知识图谱、AI推荐、学习分析、错误分析、自适应学习)
- **关系数量**: 50+个表关系
- **模块数量**: 11个功能模块

---

## 📚 核心模块详解

### 1. 学校组织架构模块

#### 🏫 学校层级关系
```
schools (学校) 
    ↓ 1:N
grades (年级)
    ↓ 1:N  
classes (班级)
    ↓ N:N
class_students (班级学生关联)
    ↓ N:1
users (学生用户)
```

#### 关键查询示例
```sql
-- 获取某个学校的所有班级信息
SELECT s.school_name, g.grade_name, c.class_name, c.class_code
FROM schools s
JOIN grades g ON s.id = g.school_id
JOIN classes c ON g.id = c.grade_id
WHERE s.id = ?;

-- 获取班级的所有学生
SELECT u.real_name, u.student_id, cs.student_number
FROM classes c
JOIN class_students cs ON c.id = cs.class_id
JOIN users u ON cs.student_id = u.id
WHERE c.id = ? AND cs.is_active = 1;
```

### 2. 作业管理系统模块

#### 📝 作业流程关系
```
homeworks (作业模板)
    ↓ 1:N
homework_assignments (作业分配)
    ↓ 1:N
homework_submissions (学生提交)
    ↓ 1:1
homework_progress (答题进度)
```

#### 关键查询示例
```sql
-- 获取作业的所有题目
SELECT q.id, q.title, q.content, q.question_type, q.score
FROM homeworks h
JOIN questions q ON h.id = q.homework_id
WHERE h.id = ?
ORDER BY q.question_order;

-- 获取学生的作业列表
SELECT h.title, h.subject, ha.due_date_override, hs.status
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = ?
WHERE ha.assigned_to_type = 'student' AND ha.assigned_to_id = ?
   OR ha.assigned_to_type = 'class' AND ha.assigned_to_id IN (
       SELECT class_id FROM class_students WHERE student_id = ?
   );
```

### 3. 用户权限系统模块

#### 👥 用户角色关系
```
users (用户基础信息)
    ↓ 1:N
user_sessions (用户会话)

users (用户)
    ↓ 1:N  
notifications (通知消息)
```

---

## 🔗 表关系详解

### 一对多关系 (1:N)

| 主表 | 从表 | 外键字段 | 说明 |
|------|------|----------|------|
| schools | grades | school_id | 一个学校有多个年级 |
| grades | classes | grade_id | 一个年级有多个班级 |
| homeworks | questions | homework_id | 一个作业有多个题目 |
| homeworks | homework_assignments | homework_id | 一个作业可以分配给多个对象 |
| users | homework_submissions | student_id | 一个学生有多个作业提交 |
| users | notifications | user_id | 一个用户有多个通知 |

### 多对多关系 (N:N)

| 关联表 | 主表1 | 主表2 | 说明 |
|--------|-------|-------|------|
| class_students | classes | users | 班级和学生的多对多关系 |
| homework_favorites | users | homework_assignments | 学生和作业收藏的多对多关系 |

### 一对一关系 (1:1)

| 表1 | 表2 | 关联字段 | 说明 |
|-----|-----|----------|------|
| homework_assignments | homework_submissions | assignment_id | 每个作业分配对应一个学生提交 |
| homework_submissions | homework_progress | student_id + homework_id | 每个提交对应一个进度记录 |

---

## 📊 常用查询场景

### 🎯 核心业务问题解答

#### Q1: 作业是不是按班级出的？
**答案**: 作业分配支持多种方式，不仅限于班级：

```sql
-- 查看作业分配的所有方式
SELECT
    assigned_to_type,
    COUNT(*) as assignment_count,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM homework_assignments) as percentage
FROM homework_assignments
GROUP BY assigned_to_type;

-- 结果示例：
-- assigned_to_type | assignment_count | percentage
-- 'class'          | 150             | 75.0%      (按班级分配)
-- 'student'        | 30              | 15.0%      (按个人分配)
-- 'grade'          | 20              | 10.0%      (按年级分配)
-- 'all'            | 0               | 0.0%       (全校分配)
```

**分配类型说明**:
- `class`: 按班级分配 (最常用，约75%)
- `student`: 按个人分配 (个性化作业)
- `grade`: 按年级分配 (统一考试)
- `all`: 全校分配 (重要通知作业)

#### Q2: 如何获取某个老师在某个班级的作业记录？

```sql
-- 方案1: 获取老师在指定班级布置的所有作业
SELECT
    h.id as homework_id,
    h.title as homework_title,
    h.subject,
    h.created_at as created_time,
    ha.assigned_at,
    ha.due_date_override as due_date,
    c.class_name,
    COUNT(cs.student_id) as total_students,
    COUNT(hs.id) as submitted_count,
    ROUND(COUNT(hs.id) * 100.0 / COUNT(cs.student_id), 2) as completion_rate
FROM homeworks h
JOIN homework_assignments ha ON h.id = ha.homework_id
JOIN classes c ON ha.assigned_to_id = c.id
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE h.created_by = ? -- 老师ID
  AND ha.assigned_to_type = 'class'
  AND ha.assigned_to_id = ? -- 班级ID
  AND ha.is_active = 1
GROUP BY h.id, h.title, h.subject, h.created_at, ha.assigned_at, ha.due_date_override, c.class_name
ORDER BY ha.assigned_at DESC;
```

#### Q3: 如何获取老师管理的所有班级的作业情况？

```sql
-- 方案2: 获取老师作为班主任的所有班级作业情况
SELECT
    c.class_name,
    c.class_code,
    h.title as homework_title,
    h.subject,
    ha.assigned_at,
    COUNT(cs.student_id) as class_size,
    COUNT(hs.id) as submitted_count,
    AVG(hs.score) as average_score,
    CASE
        WHEN ha.due_date_override < NOW() AND COUNT(hs.id) < COUNT(cs.student_id)
        THEN 'overdue'
        ELSE 'normal'
    END as status
FROM classes c
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
JOIN homework_assignments ha ON c.id = ha.assigned_to_id AND ha.assigned_to_type = 'class'
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE c.head_teacher_id = ? -- 老师ID (班主任)
GROUP BY c.id, c.class_name, c.class_code, h.id, h.title, h.subject, ha.assigned_at, ha.due_date_override
ORDER BY c.class_name, ha.assigned_at DESC;
```

### 场景1: 获取班级的作业完成情况
```sql
SELECT
    u.real_name AS student_name,
    h.title AS homework_title,
    COALESCE(hs.status, 'not_started') AS status,
    hs.score,
    hs.submitted_at
FROM class_students cs
JOIN users u ON cs.student_id = u.id
CROSS JOIN homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = u.id
WHERE cs.class_id = ? AND ha.assigned_to_type = 'class' AND ha.assigned_to_id = ?
ORDER BY u.real_name, h.title;
```

#### Q4: 如何区分老师布置的作业和其他老师的作业？

```sql
-- 方案3: 区分作业来源 - 我布置的 vs 其他老师布置的
SELECT
    h.title,
    h.subject,
    creator.real_name as created_by_teacher,
    CASE
        WHEN h.created_by = ? THEN '我布置的'
        ELSE '其他老师布置的'
    END as assignment_source,
    ha.assigned_at,
    c.class_name
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
JOIN users creator ON h.created_by = creator.id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE ha.assigned_to_type = 'class'
  AND ha.assigned_to_id = ? -- 班级ID
  AND ha.is_active = 1
ORDER BY assignment_source, ha.assigned_at DESC;
```

#### Q5: 如何获取老师跨班级的作业分配情况？

```sql
-- 方案4: 老师的跨班级作业分配统计
SELECT
    h.title as homework_title,
    h.subject,
    h.created_at,
    GROUP_CONCAT(c.class_name ORDER BY c.class_name) as assigned_classes,
    COUNT(DISTINCT ha.assigned_to_id) as class_count,
    SUM(
        SELECT COUNT(*)
        FROM class_students cs
        WHERE cs.class_id = ha.assigned_to_id AND cs.is_active = 1
    ) as total_students
FROM homeworks h
JOIN homework_assignments ha ON h.id = ha.homework_id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE h.created_by = ? -- 老师ID
  AND ha.assigned_to_type = 'class'
  AND ha.is_active = 1
GROUP BY h.id, h.title, h.subject, h.created_at
ORDER BY h.created_at DESC;
```

### 场景2: 获取学生的学习进度统计
```sql
SELECT
    COUNT(*) AS total_assignments,
    SUM(CASE WHEN hs.status = 'submitted' THEN 1 ELSE 0 END) AS completed_count,
    AVG(hs.score) AS average_score,
    SUM(hs.time_spent) AS total_time_spent
FROM homework_assignments ha
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = ?
WHERE (ha.assigned_to_type = 'student' AND ha.assigned_to_id = ?)
   OR (ha.assigned_to_type = 'class' AND ha.assigned_to_id IN (
       SELECT class_id FROM class_students WHERE student_id = ?
   ));
```

### 场景3: 教师作业管理完整场景

#### 3.1 获取教师的班级管理信息
```sql
SELECT
    c.class_name,
    c.class_code,
    COUNT(cs.student_id) AS student_count,
    COUNT(DISTINCT ha.id) AS assignment_count,
    AVG(hs.score) AS class_average_score
FROM classes c
LEFT JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_assignments ha ON c.id = ha.assigned_to_id AND ha.assigned_to_type = 'class'
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id
WHERE c.head_teacher_id = ?
GROUP BY c.id, c.class_name, c.class_code;
```

#### 3.2 教师作业管理仪表板数据
```sql
-- 获取教师的作业管理概览数据
SELECT
    -- 基础统计
    COUNT(DISTINCT h.id) as total_homeworks_created,
    COUNT(DISTINCT ha.id) as total_assignments,
    COUNT(DISTINCT ha.assigned_to_id) as classes_assigned_to,

    -- 完成情况统计
    COUNT(DISTINCT hs.id) as total_submissions,
    COUNT(DISTINCT CASE WHEN hs.status = 'submitted' THEN hs.id END) as completed_submissions,
    COUNT(DISTINCT CASE WHEN hs.status = 'graded' THEN hs.id END) as graded_submissions,

    -- 平均分统计
    AVG(hs.score) as overall_average_score,

    -- 时间统计
    AVG(hs.time_spent) as average_time_spent,

    -- 最近活动
    MAX(ha.assigned_at) as last_assignment_date,
    MAX(hs.submitted_at) as last_submission_date

FROM homeworks h
LEFT JOIN homework_assignments ha ON h.id = ha.homework_id
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id
WHERE h.created_by = ? -- 教师ID
  AND ha.is_active = 1;
```

#### 3.3 教师的待处理任务列表
```sql
-- 获取需要教师处理的任务
SELECT
    'grading' as task_type,
    h.title as homework_title,
    c.class_name,
    COUNT(*) as pending_count,
    MIN(hs.submitted_at) as earliest_submission
FROM homework_submissions hs
JOIN homework_assignments ha ON hs.assignment_id = ha.id
JOIN homeworks h ON ha.homework_id = h.id
JOIN classes c ON ha.assigned_to_id = c.id
WHERE h.created_by = ? -- 教师ID
  AND hs.status = 'submitted' -- 已提交但未评分
  AND ha.assigned_to_type = 'class'
GROUP BY h.id, h.title, c.class_name

UNION ALL

SELECT
    'overdue_reminder' as task_type,
    h.title as homework_title,
    c.class_name,
    COUNT(cs.student_id) - COUNT(hs.id) as not_submitted_count,
    ha.due_date_override as due_date
FROM homework_assignments ha
JOIN homeworks h ON ha.homework_id = h.id
JOIN classes c ON ha.assigned_to_id = c.id
JOIN class_students cs ON c.id = cs.class_id AND cs.is_active = 1
LEFT JOIN homework_submissions hs ON ha.id = hs.assignment_id AND hs.student_id = cs.student_id
WHERE h.created_by = ? -- 教师ID
  AND ha.assigned_to_type = 'class'
  AND ha.due_date_override < NOW() -- 已过期
  AND ha.is_active = 1
GROUP BY h.id, h.title, c.class_name, ha.due_date_override
HAVING not_submitted_count > 0

ORDER BY task_type, earliest_submission DESC;
```

---

## 🔍 索引优化建议

### 高频查询索引
```sql
-- 作业查询优化
CREATE INDEX idx_homework_assignments_student ON homework_assignments(assigned_to_type, assigned_to_id);
CREATE INDEX idx_homework_submissions_student_status ON homework_submissions(student_id, status);
CREATE INDEX idx_questions_homework_order ON questions(homework_id, question_order);

-- 班级管理优化  
CREATE INDEX idx_class_students_active ON class_students(class_id, is_active);
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read, created_at);

-- 时间范围查询优化
CREATE INDEX idx_homework_assignments_due_date ON homework_assignments(due_date_override);
CREATE INDEX idx_homework_submissions_submitted_at ON homework_submissions(submitted_at);
```

---

## ⚠️ 数据完整性约束

### 外键约束
- 所有关联表都设置了外键约束，确保数据一致性
- 删除操作需要考虑级联影响

### 业务规则约束
- 学生只能属于同一学校的班级
- 作业分配的目标必须存在（学生/班级/年级）
- 作业提交必须在截止时间前（业务层控制）

### 数据验证规则
- 用户名和邮箱唯一性
- 密码哈希存储
- 时间字段的合理性检查

---

## 🚀 开发使用指南

### 1. 新增作业流程
1. 在 `homeworks` 表创建作业模板
2. 在 `questions` 表添加题目
3. 在 `homework_assignments` 表创建分配记录
4. 系统自动在 `notifications` 表创建通知

### 2. 学生答题流程
1. 查询 `homework_assignments` 获取分配的作业
2. 在 `homework_progress` 表保存答题进度
3. 在 `homework_submissions` 表提交最终答案

### 3. 班级管理流程
1. 通过 `class_students` 表管理班级成员
2. 使用 `homework_assignments` 进行批量作业分配
3. 通过统计查询获取班级整体情况

---

---

## 📋 完整表结构清单

### 学校组织架构 (6张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| schools | 学校基础信息 | school_name, school_code, school_type | 1:N → grades |
| grades | 年级信息 | grade_name, grade_level, academic_year | N:1 ← schools, 1:N → classes |
| classes | 班级信息 | class_name, class_code, head_teacher_id | N:1 ← grades, 1:N → class_students |
| class_students | 班级学生关联 | class_id, student_id, student_number | N:1 ← classes, N:1 ← users |
| curriculum_standards | 课程标准 | standard_name, grade_range | N:1 ← schools |
| subjects | 学科信息 | subject_name, subject_code | N:1 ← curriculum_standards |

### 课程教学体系 (4张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| courses | 课程信息 | course_name, grade_level, semester | N:1 ← subjects |
| course_modules | 课程模块 | module_name, module_order, learning_goals | N:1 ← courses |
| chapters | 章节信息 | chapter_name, chapter_order, difficulty_level | N:1 ← course_modules |
| lessons | 课时信息 | lesson_title, duration_minutes, lesson_type | N:1 ← chapters |

### 作业管理系统 (8张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| homeworks | 作业模板 | title, subject, grade, difficulty_level | 1:N → questions |
| questions | 题目信息 | title, content, question_type, score | N:1 ← homeworks |
| homework_assignments | 作业分配 | homework_id, assigned_to_type, assigned_to_id | N:1 ← homeworks |
| homework_submissions | 作业提交 | assignment_id, student_id, answers, score | N:1 ← homework_assignments |
| homework_progress | 答题进度 | student_id, homework_id, progress_data | N:1 ← users, N:1 ← homeworks |
| homework_favorites | 作业收藏 | student_id, assignment_id | N:1 ← users, N:1 ← homework_assignments |
| homework_reminders | 作业提醒 | student_id, assignment_id, reminder_time | N:1 ← users, N:1 ← homework_assignments |
| simple_questions | 简单题目(测试) | homework_id, title, content, answer | N:1 ← homeworks |

### 用户权限系统 (3张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| users | 用户基础信息 | username, email, role, real_name | 1:N → user_sessions |
| user_sessions | 用户会话 | user_id, session_token, expires_at | N:1 ← users |
| notifications | 通知消息 | user_id, title, content, is_read | N:1 ← users |

### 教学管理系统 (2张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| class_schedules | 课程安排 | course_id, class_id, teacher_id, time_slot | N:1 ← courses, N:1 ← classes |
| learning_paths | 学习路径 | student_id, path_structure, completion_rate | N:1 ← users |

### 知识图谱系统 (4张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| knowledge_points | 知识点定义 | name, description, grade_level, difficulty_level, cognitive_type | N:1 ← subjects |
| knowledge_relationships | 知识点关系 | source_point_id, target_point_id, relationship_type, strength | N:1 ← knowledge_points |
| concept_maps | 概念图 | title, map_data, layout_config, created_by | N:1 ← subjects, N:1 ← users |
| question_knowledge_points | 题目知识点关联 | question_id, knowledge_point_id, relevance_score | N:1 ← questions, N:1 ← knowledge_points |

### AI智能推荐系统 (3张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| symbol_recommendations | 符号推荐 | user_id, context, recommended_symbols, success_rate | N:1 ← users |
| problem_recommendations | 题目推荐 | user_id, question_id, difficulty_match, predicted_success_rate | N:1 ← users, N:1 ← questions |
| learning_path_recommendations | 学习路径推荐 | user_id, recommended_path, path_type, success_prediction | N:1 ← users |

### 学习分析系统 (3张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| learning_behaviors | 学习行为 | user_id, behavior_type, behavior_data, timestamp | N:1 ← users |
| interaction_logs | 交互日志 | user_id, homework_id, question_id, interaction_type, response_time | N:1 ← users, N:1 ← homeworks, N:1 ← questions |
| engagement_metrics | 参与度指标 | user_id, date, session_duration, focus_score, persistence_score | N:1 ← users |

### 错误分析系统 (2张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| error_patterns | 错误模式 | question_id, error_type, error_description, frequency | N:1 ← questions |
| misconception_analysis | 误解分析 | user_id, knowledge_point_id, misconception_type, confidence_level | N:1 ← users, N:1 ← knowledge_points |

### 自适应学习系统 (2张表)
| 表名 | 说明 | 主要字段 | 关联关系 |
|------|------|----------|----------|
| adaptive_paths | 自适应路径 | user_id, current_state, target_state, difficulty_adjustment | N:1 ← users |
| mastery_tracking | 掌握度跟踪 | user_id, knowledge_point_id, mastery_level, decay_rate | N:1 ← users, N:1 ← knowledge_points |

---

## 🔧 开发最佳实践

### 1. 查询性能优化
```sql
-- ✅ 推荐：使用索引字段进行查询
SELECT * FROM homework_assignments
WHERE assigned_to_type = 'class' AND assigned_to_id = ?;

-- ❌ 避免：全表扫描
SELECT * FROM homework_assignments
WHERE JSON_EXTRACT(notes, '$.priority') = 'high';
```

### 2. 事务处理示例
```sql
-- 创建作业并分配的事务
START TRANSACTION;

INSERT INTO homeworks (title, subject, grade, created_by)
VALUES (?, ?, ?, ?);
SET @homework_id = LAST_INSERT_ID();

INSERT INTO questions (homework_id, title, content, score)
VALUES (@homework_id, ?, ?, ?);

INSERT INTO homework_assignments (homework_id, assigned_to_type, assigned_to_id, assigned_by)
VALUES (@homework_id, 'class', ?, ?);

COMMIT;
```

### 3. 数据一致性检查
```sql
-- 检查孤立的作业提交记录
SELECT hs.id, hs.assignment_id
FROM homework_submissions hs
LEFT JOIN homework_assignments ha ON hs.assignment_id = ha.id
WHERE ha.id IS NULL;

-- 检查无效的班级学生关联
SELECT cs.id, cs.class_id, cs.student_id
FROM class_students cs
LEFT JOIN classes c ON cs.class_id = c.id
LEFT JOIN users u ON cs.student_id = u.id
WHERE c.id IS NULL OR u.id IS NULL;
```

---

## 📈 监控和维护

### 重要指标监控
- 作业提交率：`homework_submissions.status = 'submitted'` 的比例
- 系统活跃度：`user_sessions.is_active = 1` 的数量
- 数据增长：各主要表的记录数增长趋势

### 定期维护任务
- 清理过期的用户会话：`user_sessions.expires_at < NOW()`
- 归档历史作业数据：超过学年的作业记录
- 优化查询性能：分析慢查询日志

---

**📝 注意**: 本文档基于 `architect/04_数据模型设计_整合版.sql` 的表结构设计，开发时请参考最新的SQL文件获取准确的字段定义。
