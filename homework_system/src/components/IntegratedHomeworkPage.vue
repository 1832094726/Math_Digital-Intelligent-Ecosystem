<!--
  Êñá‰ª∂Âêç: IntegratedHomeworkPage.vue
  ÊèèËø∞: ÈõÜÊàêÂõõ‰∏™Ê®°ÂùóÁöÑ‰∏ªÈ°µÈù¢ÔºåÂåÖÊã¨‰Ωú‰∏öÁÆ°ÁêÜ„ÄÅÁü•ËØÜÊé®Ëçê„ÄÅÁªÉ‰π†Êé®ËçêÂíåÂèçÈ¶àÊ®°Âùó
  ÂàõÂª∫Êó•Êúü: 2023-06-15
-->

<template>
  <div class="integrated-homework-page homework-container">
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <header class="page-header">
      <div class="header-left">
        <!-- ÁßªÂä®Á´ØÂ∑¶‰æßËèúÂçïÊåâÈíÆ -->
        <el-button
          class="mobile-menu-btn"
          icon="el-icon-menu"
          @click="toggleLeftPanel"
          v-show="isMobile"
          type="text"
          size="medium"
        ></el-button>
        <h2>Êô∫ËÉΩ‰Ωú‰∏öÁ≥ªÁªü</h2>
      </div>
      <div class="header-right">
        <!-- Áî®Êà∑‰ø°ÊÅØ -->
        <div class="user-info" v-if="user">
          <span class="user-name">{{ user.real_name || user.username }}</span>
          <span class="user-role">{{ getRoleText(user.role) }}</span>
        </div>

        <!-- ÈÄÄÂá∫ÁôªÂΩïÊåâÈíÆ -->
        <el-button
          class="logout-btn"
          icon="el-icon-switch-button"
          @click="handleLogout"
          type="text"
          size="medium"
        >ÈÄÄÂá∫</el-button>

        <!-- ÁßªÂä®Á´ØÂè≥‰æßÈù¢ÊùøÊåâÈíÆ -->
        <el-button
          class="mobile-panel-btn"
          icon="el-icon-s-grid"
          @click="toggleRightPanel"
          v-show="isMobile"
          type="text"
          size="medium"
        ></el-button>
      </div>
    </header>
    
    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <main class="page-content">
      <!-- Â∑¶‰æß‰Ωú‰∏öÁÆ°ÁêÜ -->
      <div class="left-panel" :class="{ 'panel-hidden': isMobile && !showLeftPanel }">
        <!-- ÁßªÂä®Á´ØÈÅÆÁΩ©Â±Ç -->
        <div class="panel-overlay" v-if="isMobile && showLeftPanel" @click="hideLeftPanel"></div>
        <div class="panel-content">
          <HomeworkManagement
            :homeworks="homeworks"
            :activeHomeworkId="currentHomework ? currentHomework.id : ''"
            @select-homework="selectHomework"
            @refresh-homeworks="fetchHomeworks"
          />
        </div>
      </div>
      
      <!-- ‰∏≠Èó¥‰Ωú‰∏öÂÜÖÂÆπ -->
      <div class="center-panel">
        <div v-if="loading" class="loading-container">
          <el-skeleton :rows="10" animated />
        </div>
        
        <div v-else-if="!currentHomework" class="empty-state">
          <i class="el-icon-document"></i>
          <p>ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©‰∏Ä‰∏™‰Ωú‰∏ö</p>
        </div>
        
        <div v-else class="homework-content">
          <div class="homework-header">
            <h3>{{ currentHomework.title }}</h3>
            <div class="homework-meta">
              <span><i class="el-icon-date"></i> Êà™Ê≠¢Êó•Êúü: {{ formatDate(currentHomework.deadline) }}</span>
              <span><i class="el-icon-medal"></i> ÈöæÂ∫¶: {{ getDifficultyText(currentHomework.difficulty) }}</span>
            </div>
            <p class="homework-description">{{ currentHomework.description }}</p>
          </div>
          
          <div class="problem-list">
            <el-collapse v-model="activeProblemIds">
              <el-collapse-item
                v-for="question in currentHomework.questions"
                :key="question.id"
                :title="`ÈóÆÈ¢ò ${question.id} (${question.score}ÂàÜ)`"
                :name="question.id"
                :class="{ 'selected-question': selectedQuestionId === question.id }"
                @click.native="selectQuestion(question.id)"
              >
                <div class="problem-content">
                  <div class="problem-statement" v-html="question.content"></div>
                  
                  <div v-if="question.options && question.options.length > 0" class="options-area">
                    <el-radio-group v-model="answers[question.id]">
                      <el-radio 
                        v-for="(option, index) in question.options" 
                        :key="index"
                        :label="option"
                      >{{ option }}</el-radio>
                    </el-radio-group>
                  </div>
                  <div v-else class="answer-area">
                    <div
                      class="answer-input-container"
                      :class="{ 'panel-active': showSymbolPanel && currentQuestion && currentQuestion.id === question.id }"
                    >
                      <el-input
                        type="textarea"
                        :rows="4"
                        placeholder="Âú®Ê≠§ËæìÂÖ•Á≠îÊ°à..."
                        v-model="answers[question.id]"
                        @input="saveProgress"
                        @focus="onAnswerFocus(question, $event)"
                        ref="answerInput"
                        class="answer-input"
                      ></el-input>

                      <!-- Á¨¶Âè∑Êé®ËçêÈù¢Êùø -->
                      <div
                        v-if="showSymbolPanel && currentQuestion && currentQuestion.id === question.id"
                        class="symbol-recommendation-panel"
                      >
                        <div class="panel-header">
                          <h4><i class="el-icon-magic-stick"></i> Êé®ËçêÁ¨¶Âè∑</h4>
                          <div class="header-actions">
                            <!-- Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                            <div class="status-indicator">
                              <span v-if="saving" class="status-item">
                                <i class="el-icon-loading"></i>
                                <span>‰øùÂ≠ò‰∏≠</span>
                              </span>
                              <span v-else-if="symbolLoading" class="status-item">
                                <i class="el-icon-loading"></i>
                                <span>Âä†ËΩΩ‰∏≠</span>
                              </span>
                              <span v-else class="status-item ready">
                                <i class="el-icon-check"></i>
                                <span>Â∞±Áª™</span>
                              </span>
                            </div>
                            <el-button
                              type="text"
                              icon="el-icon-close"
                              @click="closeSymbolPanel"
                              class="close-btn"
                            ></el-button>
                          </div>
                        </div>

                        <div v-if="symbolLoading" class="loading-state">
                          <i class="el-icon-loading"></i>
                          <span>Âä†ËΩΩÊé®ËçêÁ¨¶Âè∑‰∏≠...</span>
                        </div>

                        <div v-else class="symbol-content">
                          <!-- Êô∫ËÉΩÊé®ËçêÁ¨¶Âè∑ - ÊîπÂêçÂπ∂ÊîæÂú®ÊúÄ‰∏äÈù¢ -->
                          <div v-if="getCustomRecommendedSymbols(question).length > 0" class="symbol-category">
                            <h5>üí° Êô∫ËÉΩÊé®Ëçê</h5>
                            <div class="symbol-grid">
                              <button
                                v-for="symbol in getCustomRecommendedSymbols(question)"
                                :key="symbol.id"
                                class="symbol-btn"
                                :title="symbol.description"
                                @click="insertSymbol(symbol.symbol, question.id)"
                              >
                                {{ symbol.symbol }}
                              </button>
                            </div>
                          </div>

                          <!-- Âü∫Á°ÄÊï∞Â≠¶Á¨¶Âè∑ -->
                          <div class="symbol-category">
                            <h5>‚ûï Âü∫Á°ÄËøêÁÆó</h5>
                            <div class="symbol-grid">
                              <button
                                v-for="symbol in basicSymbols"
                                :key="symbol.id"
                                class="symbol-btn"
                                :title="symbol.description"
                                @click="insertSymbol(symbol.symbol, question.id)"
                              >
                                {{ symbol.symbol }}
                              </button>
                            </div>
                          </div>

                          <!-- Âá†‰ΩïÁ¨¶Âè∑ -->
                          <div class="symbol-category">
                            <h5>üìê Âá†‰ΩïÁ¨¶Âè∑</h5>
                            <div class="symbol-grid">
                              <button
                                v-for="symbol in geometrySymbols"
                                :key="symbol.id"
                                class="symbol-btn"
                                :title="symbol.description"
                                @click="insertSymbol(symbol.symbol, question.id)"
                              >
                                {{ symbol.symbol }}
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </el-collapse-item>
            </el-collapse>
          </div>
          
          <div class="homework-actions">
            <el-button 
              type="primary" 
              :disabled="!canSubmit"
              @click="submitHomework"
              :loading="submitting"
            >Êèê‰∫§‰Ωú‰∏ö</el-button>
            <el-button 
              type="info" 
              @click="saveProgress"
              :loading="saving"
            >‰øùÂ≠òËøõÂ∫¶</el-button>
          </div>
          
          <!-- ÂèçÈ¶àÂå∫Âüü -->
          <div v-if="feedback" class="feedback-container">
            <FeedbackModule :feedback="feedback" />
          </div>
        </div>
      </div>
      
      <!-- Âè≥‰æßÊé®ËçêÈù¢Êùø -->
      <div class="right-panel" :class="{ 'panel-hidden': isMobile && !showRightPanel }">
        <!-- ÁßªÂä®Á´ØÈÅÆÁΩ©Â±Ç -->
        <div class="panel-overlay" v-if="isMobile && showRightPanel" @click="hideRightPanel"></div>
        <div class="panel-content">
          <el-tabs v-model="activeTab" type="card">
            <el-tab-pane label="Áü•ËØÜÊé®Ëçê" name="knowledge">
              <KnowledgeRecommendation
                :currentProblem="currentProblem"
                :userContext="userContext"
                @knowledge-selected="applyKnowledge"
              />
            </el-tab-pane>
            <el-tab-pane label="ÁªÉ‰π†Êé®Ëçê" name="exercise">
              <ExerciseRecommendation
                :currentProblem="currentProblem"
                :userContext="userContext"
                @exercise-selected="selectExercise"
              />
            </el-tab-pane>
          </el-tabs>
        </div>
      </div>
    </main>
  </div>
</template>

<script>
import { mapGetters, mapActions } from 'vuex';
import HomeworkManagement from './HomeworkManagement.vue';
import KnowledgeRecommendation from './KnowledgeRecommendation.vue';
import ExerciseRecommendation from './ExerciseRecommendation.vue';
import FeedbackModule from './FeedbackModule.vue';
import { formatDate } from '../utils/dateFormat';
import axios from 'axios';

export default {
  name: 'IntegratedHomeworkPage',

  components: {
    HomeworkManagement,
    KnowledgeRecommendation,
    ExerciseRecommendation,
    FeedbackModule
  },


  
  data() {
    return {
      loading: false,
      submitting: false,
      saving: false,
      activeProblemIds: [],
      activeTab: 'knowledge',
      answers: {},
      feedback: null,
      saveTimeout: null,

      // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÈ¢òÁõÆIDÔºàÁî®‰∫éÂè≥‰æßÊé®ËçêÔºâ
      selectedQuestionId: null,

      // ÂìçÂ∫îÂºèÂ∏ÉÂ±ÄÁõ∏ÂÖ≥
      isMobile: false,
      showLeftPanel: false,
      showRightPanel: false,

      // Á¨¶Âè∑Êé®ËçêÁõ∏ÂÖ≥
      showSymbolPanel: false,
      symbolLoading: false,
      currentQuestion: null,
      recommendedSymbols: [],

      // Âü∫Á°ÄÊï∞Â≠¶Á¨¶Âè∑
      basicSymbols: [
        { id: 1, symbol: '+', description: 'Âä†Âè∑' },
        { id: 2, symbol: '-', description: 'ÂáèÂè∑' },
        { id: 3, symbol: '√ó', description: '‰πòÂè∑' },
        { id: 4, symbol: '√∑', description: 'Èô§Âè∑' },
        { id: 5, symbol: '=', description: 'Á≠âÂè∑' },
        { id: 6, symbol: '‚â†', description: '‰∏çÁ≠âÂè∑' },
        { id: 7, symbol: '>', description: 'Â§ß‰∫é' },
        { id: 8, symbol: '<', description: 'Â∞è‰∫é' },
        { id: 9, symbol: '‚â•', description: 'Â§ß‰∫éÁ≠â‰∫é' },
        { id: 10, symbol: '‚â§', description: 'Â∞è‰∫éÁ≠â‰∫é' },
        { id: 11, symbol: '¬≤', description: 'Âπ≥Êñπ' },
        { id: 12, symbol: '¬≥', description: 'Á´ãÊñπ' },
        { id: 13, symbol: '‚àö', description: 'Ê†πÂè∑' },
        { id: 14, symbol: 'œÄ', description: 'ÂúÜÂë®Áéá' }
      ],

      // Âá†‰ΩïÁ¨¶Âè∑
      geometrySymbols: [
        { id: 15, symbol: '‚à†', description: 'Ëßí' },
        { id: 16, symbol: '‚ñ≥', description: '‰∏âËßíÂΩ¢' },
        { id: 17, symbol: '‚ñ°', description: 'Ê≠£ÊñπÂΩ¢' },
        { id: 18, symbol: '‚óã', description: 'ÂúÜ' },
        { id: 19, symbol: '‚à•', description: 'Âπ≥Ë°å' },
        { id: 20, symbol: '‚ä•', description: 'ÂûÇÁõ¥' },
        { id: 21, symbol: '‚àΩ', description: 'Áõ∏‰ºº' },
        { id: 22, symbol: '‚âÖ', description: 'ÂÖ®Á≠â' }
      ]
    };
  },
  
  computed: {
    ...mapGetters({
      user: 'getUser',
      homeworks: 'getHomeworks',
      currentHomework: 'getCurrentHomework',
      userContext: 'getUserContext'
    }),
    
    // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÈóÆÈ¢òÔºàÁî®‰∫éÂè≥‰æßÊé®ËçêÔºâ
    currentProblem() {
      if (!this.currentHomework || !this.selectedQuestionId) return null;

      return this.currentHomework.questions.find(
        question => question.id === this.selectedQuestionId
      );
    },
    
    // ÊòØÂê¶ÂèØ‰ª•Êèê‰∫§
    canSubmit() {
      if (!this.currentHomework) return false;
      
      // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâÈóÆÈ¢òÈÉΩÂ∑≤ÂõûÁ≠î
      return this.currentHomework.questions.every(
        question => this.answers[question.id]
      );
    }
  },
  
  created() {
    // ÈÖçÁΩÆaxiosÂÆû‰æã
    this.$http = axios.create({
      baseURL: 'http://localhost:8081',
      timeout: 10000
    });

    // ‰ªélocalStorageËé∑ÂèñtokenÂπ∂ËÆæÁΩÆÂà∞axios header
    const token = localStorage.getItem('token');
    if (token) {
      this.$http.defaults.headers.common['Authorization'] = `Bearer ${token}`;
      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
    }

    // ÂàùÂßãÂåñÊï∞ÊçÆ
    this.initializeData();
  },

  mounted() {
    // ÂàùÂßãÂåñÂìçÂ∫îÂºèÊ£ÄÊü•
    this.checkMobile();

    // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ
    window.addEventListener('resize', this.handleResize);
  },

  beforeDestroy() {
    // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨
    window.removeEventListener('resize', this.handleResize);
  },
  
  methods: {
    ...mapActions([
      'login',
      'fetchHomeworks',
      'fetchHomeworkDetail',
      'fetchUserContext',
      'submitHomework',
      'saveHomeworkProgress'
    ]),
    
    // ÂàùÂßãÂåñÊï∞ÊçÆ
    async initializeData() {
      try {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
        const token = localStorage.getItem('token');
        if (!token) {
          this.$router.push('/login');
          return;
        }

        // Ëé∑Âèñ‰Ωú‰∏öÂàóË°®
        await this.fetchHomeworks();

        // Ëé∑ÂèñÁî®Êà∑‰∏ä‰∏ãÊñá
        await this.fetchUserContext();
      } catch (error) {
        console.error('ÂàùÂßãÂåñÊï∞ÊçÆÂ§±Ë¥•', error);

        // Â¶ÇÊûúÊòØËÆ§ËØÅÈîôËØØÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
        if (error.response && error.response.status === 401) {
          localStorage.removeItem('token');
          this.$router.push('/login');
        } else {
          this.$message.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
        }
      }
    },
    
    // ÈÄâÊã©‰Ωú‰∏ö
    async selectHomework(homeworkId) {
      this.loading = true;
      this.answers = {};
      this.feedback = null;
      
      try {
        // Ëé∑Âèñ‰Ωú‰∏öËØ¶ÊÉÖ
        const homework = await this.fetchHomeworkDetail(homeworkId);
        
        // ÂàùÂßãÂåñÁ≠îÊ°à
        if (homework.savedAnswers) {
          this.answers = { ...homework.savedAnswers };
        }
        
        // Â¶ÇÊûúÊòØÂ∑≤ÊâπÊîπÁöÑ‰Ωú‰∏öÔºåÊòæÁ§∫ÂèçÈ¶à
        if (homework.status === 'graded' && homework.feedback) {
          this.feedback = homework.feedback;
        }
        
        // ÈªòËÆ§Â±ïÂºÄÊâÄÊúâÈóÆÈ¢ò
        if (homework.questions && homework.questions.length > 0) {
          this.activeProblemIds = homework.questions.map(q => q.id);
          // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™È¢òÁõÆÁî®‰∫éÂè≥‰æßÊé®Ëçê
          this.selectedQuestionId = homework.questions[0].id;
        }
      } catch (error) {
        console.error('Ëé∑Âèñ‰Ωú‰∏öËØ¶ÊÉÖÂ§±Ë¥•', error);
        this.$message.error('Ëé∑Âèñ‰Ωú‰∏öËØ¶ÊÉÖÂ§±Ë¥•');
      } finally {
        this.loading = false;
      }
    },
    
    // ‰øùÂ≠òËøõÂ∫¶
    saveProgress() {
      // Èò≤ÊäñÂ§ÑÁêÜÔºåÈÅøÂÖçÈ¢ëÁπÅ‰øùÂ≠ò
      clearTimeout(this.saveTimeout);
      this.saveTimeout = setTimeout(async () => {
        if (!this.currentHomework) return;

        this.saving = true;

        try {
          await this.saveHomeworkProgress({
            homeworkId: this.currentHomework.id,
            answers: this.answers
          });

          // ÁßªÈô§È¢ëÁπÅÁöÑÊàêÂäüÊèêÁ§∫
          // this.$message.success('ËøõÂ∫¶Â∑≤‰øùÂ≠ò');
        } catch (error) {
          console.error('‰øùÂ≠òËøõÂ∫¶Â§±Ë¥•', error);
          this.$message.error('‰øùÂ≠òËøõÂ∫¶Â§±Ë¥•');
        } finally {
          this.saving = false;
        }
      }, 1000);
    },
    
    // Êèê‰∫§‰Ωú‰∏ö
    async submitHomework() {
      if (!this.currentHomework) return;
      
      this.submitting = true;
      
      try {
        const result = await this.submitHomework({
          homeworkId: this.currentHomework.id,
          answers: this.answers
        });
        
        this.$message.success('‰Ωú‰∏öÊèê‰∫§ÊàêÂäü');
        
        // ÊòæÁ§∫ÂèçÈ¶à
        if (result.feedback) {
          this.feedback = result.feedback;
        }
      } catch (error) {
        console.error('Êèê‰∫§‰Ωú‰∏öÂ§±Ë¥•', error);
        this.$message.error('Êèê‰∫§‰Ωú‰∏öÂ§±Ë¥•');
      } finally {
        this.submitting = false;
      }
    },
    
    // Â∫îÁî®Áü•ËØÜÁÇπ
    applyKnowledge(knowledge) {
      if (!this.currentProblem) return;
      
      // Âú®ÂΩìÂâçÁ≠îÊ°à‰∏≠ÊèíÂÖ•Áü•ËØÜÁÇπ
      const problemId = this.currentProblem.id;
      const currentAnswer = this.answers[problemId] || '';
      
      // Ê†πÊçÆÁü•ËØÜÁÇπÁ±ªÂûãÂ∫îÁî®‰∏çÂêåÁöÑÂÜÖÂÆπ
      let contentToInsert = '';
      
      if (knowledge.formulas && knowledge.formulas.length > 0) {
        contentToInsert = knowledge.formulas[0];
      } else {
        contentToInsert = knowledge.title;
      }
      
      this.answers[problemId] = currentAnswer + '\n' + contentToInsert;
      this.saveProgress();
    },
    
    // ÈÄâÊã©ÁªÉ‰π†
    selectExercise(exercise) {
      // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫îË∑≥ËΩ¨Âà∞ÁªÉ‰π†È°µÈù¢
      this.$message.info(`Âç≥Â∞ÜÂºÄÂßãÁªÉ‰π†Ôºö${exercise.title}`);
    },

    // ÈÄâÊã©È¢òÁõÆÔºàÁî®‰∫éÂè≥‰æßÊé®ËçêÔºâ
    selectQuestion(questionId) {
      this.selectedQuestionId = questionId;
    },

    // ÂìçÂ∫îÂºèÂ∏ÉÂ±ÄÊñπÊ≥ï

    // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÁßªÂä®Á´Ø
    checkMobile() {
      this.isMobile = window.innerWidth <= 768;
    },

    // ÂàáÊç¢Â∑¶‰æßÈù¢Êùø
    toggleLeftPanel() {
      console.log('toggleLeftPanel called, current state:', this.showLeftPanel);
      console.log('isMobile:', this.isMobile);
      this.showLeftPanel = !this.showLeftPanel;
      if (this.showLeftPanel) {
        this.showRightPanel = false; // ÂÖ≥Èó≠Âè≥‰æßÈù¢Êùø
      }
      console.log('new showLeftPanel state:', this.showLeftPanel);
    },

    // ÂàáÊç¢Âè≥‰æßÈù¢Êùø
    toggleRightPanel() {
      console.log('toggleRightPanel called, current state:', this.showRightPanel);
      console.log('isMobile:', this.isMobile);
      this.showRightPanel = !this.showRightPanel;
      if (this.showRightPanel) {
        this.showLeftPanel = false; // ÂÖ≥Èó≠Â∑¶‰æßÈù¢Êùø
      }
      console.log('new showRightPanel state:', this.showRightPanel);
    },

    // ÈöêËóèÂ∑¶‰æßÈù¢Êùø
    hideLeftPanel() {
      this.showLeftPanel = false;
    },

    // ÈöêËóèÂè≥‰æßÈù¢Êùø
    hideRightPanel() {
      this.showRightPanel = false;
    },

    // Á™óÂè£Â§ßÂ∞èÂèòÂåñÂ§ÑÁêÜ
    handleResize() {
      this.checkMobile();

      // Â¶ÇÊûúÂàáÊç¢Âà∞Ê°åÈù¢Á´ØÔºåÈáçÁΩÆÈù¢ÊùøÁä∂ÊÄÅ
      if (!this.isMobile) {
        this.showLeftPanel = false;
        this.showRightPanel = false;
      }
    },

    // Á¨¶Âè∑Êé®ËçêÁõ∏ÂÖ≥ÊñπÊ≥ï

    // Á≠îÊ°àËæìÂÖ•Ê°ÜËé∑ÂæóÁÑ¶ÁÇπÊó∂
    async onAnswerFocus(question, event) {
      this.currentQuestion = question;
      this.showSymbolPanel = true;

      // Êõ¥Êñ∞ÈÄâ‰∏≠ÁöÑÈ¢òÁõÆÔºàÁî®‰∫éÂè≥‰æßÊé®ËçêÔºâ
      this.selectedQuestionId = question.id;

      // Âπ≥ÊªëÊªöÂä®Á°Æ‰øùÈù¢ÊùøÂèØËßÅ
      this.$nextTick(() => {
        setTimeout(() => {
          const inputElement = event.target;
          if (inputElement) {
            inputElement.scrollIntoView({
              behavior: 'smooth',
              block: 'center'
            });
          }
        }, 100); // Á≠âÂæÖÈù¢ÊùøÊ∏≤ÊüìÂÆåÊàê
      });

      // Ëé∑ÂèñÊô∫ËÉΩÊé®ËçêÁ¨¶Âè∑
      await this.loadRecommendedSymbols(question);
    },

    // ÂÖ≥Èó≠Á¨¶Âè∑Èù¢Êùø
    closeSymbolPanel() {
      this.showSymbolPanel = false;
      this.currentQuestion = null;
      this.recommendedSymbols = [];
    },

    // Âä†ËΩΩÊé®ËçêÁ¨¶Âè∑
    async loadRecommendedSymbols(question) {
      this.symbolLoading = true;

      try {
        // Ë∞ÉÁî®Á¨¶Âè∑Êé®ËçêÊúçÂä°
        const symbolService = await import('../services/symbolRecommendationService');

        const response = await symbolService.getSymbolRecommendations({
          user_id: this.user?.id || 1,
          question_id: question.id,
          question_text: question.content,
          current_topic: question.knowledge_points?.[0] || '',
          difficulty_level: this.currentHomework?.difficulty || 'medium'
        });

        if (response.data && response.data.symbols) {
          this.recommendedSymbols = response.data.symbols.map(symbol => ({
            id: symbol.id,
            symbol: symbol.symbol,
            description: symbol.description,
            category: symbol.category,
            relevance: symbol.relevance
          }));
        } else {
          // Â¶ÇÊûúÊ≤°ÊúâËøîÂõûÁ¨¶Âè∑Ôºå‰ΩøÁî®ÈªòËÆ§Êé®Ëçê
          this.recommendedSymbols = this.getDefaultRecommendedSymbols(question);
        }
      } catch (error) {
        console.error('Ëé∑ÂèñÊé®ËçêÁ¨¶Âè∑Â§±Ë¥•:', error);
        // ‰ΩøÁî®ÈªòËÆ§Êé®ËçêÁ¨¶Âè∑
        this.recommendedSymbols = this.getDefaultRecommendedSymbols(question);
      } finally {
        this.symbolLoading = false;
      }
    },

    // Ëé∑ÂèñÂÆöÂà∂Êé®ËçêÁ¨¶Âè∑ÔºàÂü∫‰∫éÈ¢òÁõÆËß£Ê≥ïÁöÑÂÜôÊ≠ªÊé•Âè£Ôºâ
    getCustomRecommendedSymbols(question) {
      const content = question.content.toLowerCase();
      const customRecommended = [];

      // Ê†πÊçÆÈ¢òÁõÆÁ±ªÂûãÂíåËß£Ê≥ïÊé®ËçêÁâπÂÆöÁ¨¶Âè∑

      // ‰∏ÄÂÖÉ‰∫åÊ¨°ÊñπÁ®ãÁ±ªÈ¢òÁõÆ
      if (content.includes('ÊñπÁ®ã') && (content.includes('x¬≤') || content.includes('x^2') || content.includes('‰∫åÊ¨°'))) {
        customRecommended.push(
          { id: 'custom1', symbol: 'x', description: 'Êú™Áü•Êï∞x' },
          { id: 'custom2', symbol: '¬≤', description: 'Âπ≥Êñπ' },
          { id: 'custom3', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom4', symbol: '¬±', description: 'Ê≠£Ë¥üÂè∑' },
          { id: 'custom5', symbol: '‚àö', description: 'Ê†πÂè∑' }
        );
      }

      // Ê¢ØÂΩ¢Èù¢ÁßØÁ±ªÈ¢òÁõÆ
      else if (content.includes('Ê¢ØÂΩ¢') && content.includes('Èù¢ÁßØ')) {
        customRecommended.push(
          { id: 'custom6', symbol: 'S', description: 'Èù¢ÁßØS' },
          { id: 'custom7', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom8', symbol: '(', description: 'Â∑¶Êã¨Âè∑' },
          { id: 'custom9', symbol: ')', description: 'Âè≥Êã¨Âè∑' },
          { id: 'custom10', symbol: '+', description: 'Âä†Âè∑' },
          { id: 'custom11', symbol: '√ó', description: '‰πòÂè∑' },
          { id: 'custom12', symbol: '√∑', description: 'Èô§Âè∑' },
          { id: 'custom13', symbol: '2', description: 'Êï∞Â≠ó2' }
        );
      }

      // ÂúÜÂΩ¢Áõ∏ÂÖ≥È¢òÁõÆ
      else if (content.includes('ÂúÜ') && (content.includes('Èù¢ÁßØ') || content.includes('Âë®Èïø'))) {
        customRecommended.push(
          { id: 'custom14', symbol: 'œÄ', description: 'ÂúÜÂë®Áéá' },
          { id: 'custom15', symbol: 'r', description: 'ÂçäÂæÑr' },
          { id: 'custom16', symbol: '¬≤', description: 'Âπ≥Êñπ' },
          { id: 'custom17', symbol: '√ó', description: '‰πòÂè∑' },
          { id: 'custom18', symbol: '=', description: 'Á≠âÂè∑' }
        );
      }

      // ‰∏âËßíÂΩ¢Áõ∏ÂÖ≥È¢òÁõÆ
      else if (content.includes('‰∏âËßíÂΩ¢') && (content.includes('Èù¢ÁßØ') || content.includes('Ëßí'))) {
        customRecommended.push(
          { id: 'custom19', symbol: '‚ñ≥', description: '‰∏âËßíÂΩ¢' },
          { id: 'custom20', symbol: '‚à†', description: 'Ëßí' },
          { id: 'custom21', symbol: '¬∞', description: 'Â∫¶' },
          { id: 'custom22', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom23', symbol: '√∑', description: 'Èô§Âè∑' }
        );
      }

      // ÂàÜÊï∞Áõ∏ÂÖ≥È¢òÁõÆ
      else if (content.includes('ÂàÜÊï∞') || content.includes('ÂàÜÂ≠ê') || content.includes('ÂàÜÊØç')) {
        customRecommended.push(
          { id: 'custom24', symbol: '/', description: 'ÂàÜÊï∞Á∫ø' },
          { id: 'custom25', symbol: '+', description: 'Âä†Âè∑' },
          { id: 'custom26', symbol: '-', description: 'ÂáèÂè∑' },
          { id: 'custom27', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom28', symbol: '(', description: 'Â∑¶Êã¨Âè∑' },
          { id: 'custom29', symbol: ')', description: 'Âè≥Êã¨Âè∑' }
        );
      }

      // ÁôæÂàÜÊØîÁõ∏ÂÖ≥È¢òÁõÆ
      else if (content.includes('%') || content.includes('ÁôæÂàÜ') || content.includes('ÊäòÊâ£') || content.includes('Âà©Áéá')) {
        customRecommended.push(
          { id: 'custom30', symbol: '%', description: 'ÁôæÂàÜÂè∑' },
          { id: 'custom31', symbol: '√ó', description: '‰πòÂè∑' },
          { id: 'custom32', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom33', symbol: '+', description: 'Âä†Âè∑' },
          { id: 'custom34', symbol: '-', description: 'ÂáèÂè∑' }
        );
      }

      // ‰∏ÄËà¨ËÆ°ÁÆóÈ¢ò
      else if (content.includes('ËÆ°ÁÆó') || content.includes('Ê±Ç') || content.includes('Â§öÂ∞ë')) {
        customRecommended.push(
          { id: 'custom35', symbol: '=', description: 'Á≠âÂè∑' },
          { id: 'custom36', symbol: '+', description: 'Âä†Âè∑' },
          { id: 'custom37', symbol: '-', description: 'ÂáèÂè∑' },
          { id: 'custom38', symbol: '√ó', description: '‰πòÂè∑' },
          { id: 'custom39', symbol: '√∑', description: 'Èô§Âè∑' }
        );
      }

      return customRecommended;
    },

    // Ëé∑ÂèñÈªòËÆ§Êé®ËçêÁ¨¶Âè∑ÔºàÂü∫‰∫éÈ¢òÁõÆÂÜÖÂÆπÁöÑÁÆÄÂçïÂåπÈÖçÔºâ
    getDefaultRecommendedSymbols(question) {
      const content = question.content.toLowerCase();
      const recommended = [];

      // Ê†πÊçÆÈ¢òÁõÆÂÜÖÂÆπÊé®ËçêÁ¨¶Âè∑
      if (content.includes('ÊñπÁ®ã') || content.includes('Ëß£')) {
        recommended.push(
          { id: 'rec1', symbol: 'x', description: 'Êú™Áü•Êï∞x' },
          { id: 'rec2', symbol: 'y', description: 'Êú™Áü•Êï∞y' },
          { id: 'rec3', symbol: '=', description: 'Á≠âÂè∑' }
        );
      }

      if (content.includes('Èù¢ÁßØ') || content.includes('Âë®Èïø')) {
        recommended.push(
          { id: 'rec4', symbol: '¬≤', description: 'Âπ≥Êñπ' },
          { id: 'rec5', symbol: 'œÄ', description: 'ÂúÜÂë®Áéá' },
          { id: 'rec6', symbol: '√ó', description: '‰πòÂè∑' }
        );
      }

      if (content.includes('Ëßí') || content.includes('‰∏âËßíÂΩ¢')) {
        recommended.push(
          { id: 'rec7', symbol: '‚à†', description: 'Ëßí' },
          { id: 'rec8', symbol: '‚ñ≥', description: '‰∏âËßíÂΩ¢' },
          { id: 'rec9', symbol: '¬∞', description: 'Â∫¶' }
        );
      }

      return recommended;
    },

    // ÊèíÂÖ•Á¨¶Âè∑Âà∞Á≠îÊ°à‰∏≠
    async insertSymbol(symbol, questionId) {
      const currentAnswer = this.answers[questionId] || '';

      // Ëé∑ÂèñÂΩìÂâçÂÖâÊ†á‰ΩçÁΩÆÔºàÁÆÄÂåñÂ§ÑÁêÜÔºåËøΩÂä†Âà∞Êú´Â∞æÔºâ
      this.answers[questionId] = currentAnswer + symbol;

      // ‰øùÂ≠òËøõÂ∫¶
      this.saveProgress();

      // Êõ¥Êñ∞Á¨¶Âè∑‰ΩøÁî®ÁªüËÆ°
      try {
        const symbolService = await import('../services/symbolRecommendationService');
        await symbolService.updateSymbolUsage({
          user_id: this.user?.id || 1,
          question_id: questionId,
          symbol: symbol
        });
      } catch (error) {
        console.error('Êõ¥Êñ∞Á¨¶Âè∑‰ΩøÁî®ÁªüËÆ°Â§±Ë¥•:', error);
      }

      // ËÅöÁÑ¶ÂõûÁ≠îÊ°àËæìÂÖ•Ê°Ü
      this.$nextTick(() => {
        const inputRef = this.$refs.answerInput;
        if (inputRef && Array.isArray(inputRef)) {
          // ÊâæÂà∞ÂØπÂ∫îÁöÑËæìÂÖ•Ê°Ü
          const targetInput = inputRef.find(input =>
            input.$el.closest('.problem-content')?.querySelector(`[name="${questionId}"]`)
          );
          if (targetInput) {
            targetInput.focus();
          }
        }
      });
    },
    
    // Ëé∑ÂèñÈöæÂ∫¶ÊñáÊú¨
    getDifficultyText(difficulty) {
      const difficultyMap = {
        1: 'ÁÆÄÂçï',
        2: '‰∏≠Á≠â',
        3: 'Âõ∞Èöæ',
        4: 'ÊåëÊàò',
        5: 'ÊûÅÈöæ'
      };
      return difficultyMap[difficulty] || difficulty;
    },
    
    // Ê†ºÂºèÂåñÊó•Êúü
    formatDate(date) {
      return formatDate(date, 'YYYY-MM-DD HH:mm');
    },

    // Ëé∑ÂèñËßíËâ≤ÊñáÊú¨
    getRoleText(role) {
      const roleMap = {
        'student': 'Â≠¶Áîü',
        'teacher': 'ÊïôÂ∏à',
        'admin': 'ÁÆ°ÁêÜÂëò',
        'parent': 'ÂÆ∂Èïø'
      };
      return roleMap[role] || 'Áî®Êà∑';
    },

    // ÈÄÄÂá∫ÁôªÂΩï
    async handleLogout() {
      try {
        await this.$confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü', 'ÊèêÁ§∫', {
          confirmButtonText: 'Á°ÆÂÆö',
          cancelButtonText: 'ÂèñÊ∂à',
          type: 'warning'
        });

        // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
        localStorage.removeItem('token');
        localStorage.removeItem('user');

        // Ê∏ÖÈô§axiosÈªòËÆ§header
        delete this.$http.defaults.headers.common['Authorization'];

        // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
        this.$router.push('/login');

        this.$message.success('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');

      } catch (error) {
        // Áî®Êà∑ÂèñÊ∂àÈÄÄÂá∫
        console.log('Áî®Êà∑ÂèñÊ∂àÈÄÄÂá∫ÁôªÂΩï');
      }
    }
  }
};
</script>

<style>
.integrated-homework-page {
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  height: 60px;
  background-color: #409EFF;
  color: white;
  position: relative;
  z-index: 1000;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-info {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  font-size: 14px;
}

.user-name {
  font-weight: 500;
  color: #333;
}

.user-role {
  font-size: 12px;
  color: #666;
  background: #f0f2f5;
  padding: 2px 8px;
  border-radius: 10px;
  margin-top: 2px;
}

.logout-btn {
  color: #666;
  font-size: 14px;
}

.logout-btn:hover {
  color: #409eff;
}

.mobile-menu-btn,
.mobile-panel-btn {
  display: none;
  color: white;
}

.header-left h2 {
  margin: 0;
  font-size: 20px;
}

.el-dropdown-link {
  color: white;
  cursor: pointer;
}

.page-content {
  display: flex;
  flex: 1;
  overflow: hidden;
}

.left-panel {
  width: 280px;
  border-right: 1px solid #e6e6e6;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  position: relative;
  transition: transform 0.3s ease;
}

.left-panel .panel-content {
  height: 100%;
  flex: 1;
  position: relative;
  z-index: 1000;
  background: white;
}

.left-panel .panel-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 998;
  display: none;
  pointer-events: auto;
}

.center-panel {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.right-panel {
  width: 320px;
  border-left: 1px solid #e6e6e6;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  position: relative;
  transition: transform 0.3s ease;
}

.right-panel .panel-content {
  height: 100%;
  flex: 1;
  position: relative;
  z-index: 1000;
  background: white;
}

.right-panel .panel-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 998;
  display: none;
  pointer-events: auto;
}

.loading-container {
  padding: 20px;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 300px;
  color: #909399;
}

.empty-state i {
  font-size: 48px;
  margin-bottom: 20px;
}

.homework-header {
  margin-bottom: 20px;
}

.homework-header h3 {
  margin: 0 0 10px 0;
  font-size: 22px;
  color: #303133;
}

.homework-meta {
  display: flex;
  gap: 20px;
  font-size: 14px;
  color: #606266;
  margin-bottom: 10px;
}

.homework-description {
  color: #606266;
  line-height: 1.6;
}

.problem-list {
  margin-bottom: 20px;
}

.problem-content {
  padding: 10px 0;
}

.problem-statement {
  margin-bottom: 15px;
  line-height: 1.6;
}

.answer-area {
  margin-top: 10px;
}

.homework-actions {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.feedback-container {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #e6e6e6;
}

/* ËÆ©ÂÜÖÂÆπÂå∫ÂüüËá™ÈÄÇÂ∫îÈ´òÂ∫¶ */
.problem-content {
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
}

/* Ë∞ÉÊï¥ el-collapse-item ÁöÑÈò¥ÂΩ±ÊïàÊûú */
.el-collapse-item {
  box-shadow: none !important; /* ÂéªÊéâÈò¥ÂΩ± */
  border-radius: 6px;
  margin-bottom: 8px;
}

.el-collapse-item__header {
  padding: 12px 20px !important; /* ‰∏éÂÜÖÂÆπÂå∫Âüü‰øùÊåÅ‰∏ÄËá¥ÁöÑÂ∑¶Âè≥Èó¥Ë∑ù */
  background-color: #fafafa;
  border-radius: 6px 6px 0 0;
}

.el-collapse-item.is-active .el-collapse-item__header {
  border-bottom: 1px solid #e6e6e6;
}

.el-collapse-item__wrap {
  border-radius: 0 0 6px 6px;
  overflow: hidden;
}

/* ÈÄâ‰∏≠È¢òÁõÆÁöÑÊ†∑Âºè */
.selected-question .el-collapse-item__header {
  background-color: #ECF5FF !important;
  border-left: 4px solid #409EFF !important;
  color: #409EFF !important;
  font-weight: 600 !important;
}

.selected-question .el-collapse-item__header:hover {
  background-color: #D9ECFF !important;
}

/* Á¨¶Âè∑Êé®ËçêÈù¢ÊùøÊ†∑Âºè - IEEEÈ£éÊ†º */
.answer-input-container {
  position: relative;
  transition: margin-bottom 0.3s ease;
}

.answer-input-container.panel-active {
  margin-bottom: 35vh; /* ‰ΩøÁî®ËßÜÁ™óÈ´òÂ∫¶ÁöÑ50%ÔºåÊõ¥ÁÅµÊ¥ª */
  position: relative;
}



.answer-input {
  width: 100%;
}

.symbol-recommendation-panel {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: #fefefe;
  border: 2px solid #409EFF;
  border-radius: 8px;
  box-shadow: none; /* ÂéªÊéâÈò¥ÂΩ± */
  z-index: 1000;
  margin-top: 8px;
  max-height: 400px;
  overflow-y: auto;
  font-family: 'Times New Roman', serif;
  /* Á°Æ‰øùÈù¢Êùø‰∏ç‰ºöË¢´ÈÅÆÊå° */
  min-height: 200px;
}



.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #fefefe;
  color: #606266;
  border-radius: 6px 6px 0 0;
  border-bottom: 1px solid #E4E7ED;
}

.panel-header h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.status-indicator {
  font-size: 12px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 4px;
  color: #909399;
}

.status-item.ready {
  color: #67C23A;
}

.status-item i {
  font-size: 12px;
}

.status-item .el-icon-loading {
  animation: rotating 2s linear infinite;
}

@keyframes rotating {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.close-btn {
  color: #909399 !important;
  padding: 4px !important;
}

.close-btn:hover {
  background-color: rgba(144, 147, 153, 0.1) !important;
  color: #606266 !important;
}

.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #606266;
  gap: 8px;
}

.symbol-content {
  padding: 16px;
}

.symbol-category {
  margin-bottom: 16px;
}

.symbol-category:last-child {
  margin-bottom: 0;
}

.symbol-category h5 {
  margin: 0 0 8px 0;
  font-size: 12px;
  color: #606266;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid #E4E7ED;
  padding-bottom: 4px;
  font-family: 'Times New Roman', serif;
}

.symbol-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
  gap: 6px;
}

.symbol-btn {
  width: 40px;
  height: 40px;
  border: 1px solid #DCDFE6;
  background: #ffffff;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  color: #303133;
}

.symbol-btn:hover {
  border-color: #409EFF;
  background: #ECF5FF;
  color: #409EFF;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.2);
}

.symbol-btn:active {
  transform: translateY(0);
}



/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  /* ÊòæÁ§∫ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ */
  .mobile-menu-btn,
  .mobile-panel-btn {
    display: inline-flex !important;
  }

  /* ‰∏ªÂÜÖÂÆπÂå∫ÂüüË∞ÉÊï¥ */
  .main-content {
    position: relative;
  }

  /* Â∑¶‰æßÈù¢ÊùøÁßªÂä®Á´ØÊ†∑Âºè */
  .left-panel {
    position: fixed;
    top: 60px; /* Â§¥ÈÉ®È´òÂ∫¶ */
    left: 0;
    bottom: 0;
    width: 280px;
    background: white;
    z-index: 999;
    transform: translateX(-100%);
    border-right: 1px solid #e6e6e6;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
  }

  .left-panel:not(.panel-hidden) {
    transform: translateX(0);
  }

  .left-panel.panel-hidden {
    transform: translateX(-100%);
  }

  .left-panel .panel-overlay {
    display: block !important;
    z-index: 998;
  }

  /* Âè≥‰æßÈù¢ÊùøÁßªÂä®Á´ØÊ†∑Âºè */
  .right-panel {
    position: fixed;
    top: 60px;
    right: 0;
    bottom: 0;
    width: 320px;
    background: white;
    z-index: 999;
    transform: translateX(100%);
    border-left: 1px solid #e6e6e6;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
  }

  .right-panel:not(.panel-hidden) {
    transform: translateX(0);
  }

  .right-panel.panel-hidden {
    transform: translateX(100%);
  }

  .right-panel .panel-overlay {
    display: block !important;
    z-index: 998;
  }

  /* ‰∏≠Èó¥ÂÜÖÂÆπÂå∫ÂüüÂç†Êª° */
  .center-panel {
    width: 100%;
    margin: 0;
  }

  /* Á¨¶Âè∑Êé®ËçêÈù¢ÊùøÁßªÂä®Á´ØË∞ÉÊï¥ */
  .answer-input-container.panel-active {
    margin-bottom: 40vh;
  }

  .symbol-recommendation-panel {
    max-height: 300px;
  }

  .symbol-grid {
    grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
    gap: 4px;
  }

  .symbol-btn {
    width: 35px;
    height: 35px;
    font-size: 14px;
  }

  .panel-header {
    padding: 8px 12px;
  }

  .panel-header h4 {
    font-size: 12px;
  }

  .status-indicator {
    font-size: 10px;
  }
}

/* ÈöêËóèÈù¢ÊùøÁöÑÊ†∑Âºè */
.panel-hidden {
  transform: translateX(-100%) !important;
}

.right-panel.panel-hidden {
  transform: translateX(100%) !important;
}
</style>
